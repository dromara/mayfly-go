var ol=Object.defineProperty;var Le=Object.getOwnPropertySymbols;var nl=Object.prototype.hasOwnProperty,il=Object.prototype.propertyIsEnumerable;var ze=(Q,$,t)=>$ in Q?ol(Q,$,{enumerable:!0,configurable:!0,writable:!0,value:t}):Q[$]=t,De=(Q,$)=>{for(var t in $||($={}))nl.call($,t)&&ze(Q,t,$[t]);if(Le)for(var t of Le($))il.call($,t)&&ze(Q,t,$[t]);return Q};import{d as qe,r as je,c as Ie,t as Se,L as Te,h as f,i as d,j as z,k as e,w as a,q as he,v as i,l,X as sl,G as ce,Q as H,R as Y,m as _,s as A,E as ye,F as T,a1 as se,e as dl,f as rl,V as Ne,I as Ee,a3 as ml,U as ke,W as Re,N as pl,O as bl,a4 as Me,a5 as cl}from"./index.db2b5b0c.js";import{f as Oe}from"./format.fd72f709.js";import{d as j,S as Qe}from"./SqlExecBox.f578db13.js";import{m as fl,_ as gl}from"./TagSelect.67390cfb.js";import{n as El,i as hl}from"./assert.d82c837d.js";import{R as Pe}from"./rsa.e4863f18.js";import{E as yl}from"./Enum.48e42737.js";import{t as _l}from"./api.1d0361cc.js";import"./Api.b0f465a3.js";import"./MonacoEditor.2c5fb328.js";const Dl={class:"dialog-footer"},vl=qe({__name:"DbEdit",props:{visible:{type:Boolean},db:{type:[Boolean,Object]},title:{type:String}},emits:["update:visible","cancel","val-change"],setup(Q,{emit:$}){const t=Q,de={tagId:[{required:!0,message:"\u8BF7\u9009\u62E9\u6807\u7B7E",trigger:["change","blur"]}],name:[{required:!0,message:"\u8BF7\u8F93\u5165\u522B\u540D",trigger:["change","blur"]}],type:[{required:!0,message:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93\u7C7B\u578B",trigger:["change","blur"]}],host:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E3B\u673Aip\u548Cport",trigger:["change","blur"]}],username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:["change","blur"]}],database:[{required:!0,message:"\u8BF7\u6DFB\u52A0\u6570\u636E\u5E93",trigger:["change","blur"]}]},D=je(null),C=Ie({dialogVisible:!1,allDatabases:[],databaseList:[],sshTunnelMachineList:[],form:{id:null,tagId:null,tagPath:null,type:null,name:null,host:"",port:3306,username:null,password:null,params:null,database:"",project:null,projectId:null,envId:null,env:null,remark:"",enableSshTunnel:null,sshTunnelMachineId:null},pwd:"",btnLoading:!1}),{dialogVisible:J,allDatabases:K,databaseList:te,sshTunnelMachineList:fe,form:p,pwd:ee,btnLoading:N}=Se(C);Te(t,q=>{C.dialogVisible=q.visible,C.dialogVisible&&(q.db?(C.form=De({},q.db),C.databaseList=q.db.database.split(" ")):(C.form={port:3306,enableSshTunnel:-1},C.databaseList=[]),le())});const U=()=>{C.form.database=C.databaseList.length==0?"":C.databaseList.join(" ")},le=async()=>{if(C.form.enableSshTunnel==1&&C.sshTunnelMachineList.length==0){const q=await fl.list.request({pageNum:1,pageSize:100});C.sshTunnelMachineList=q.list}},ue=async()=>{const q=De({},C.form);q.password=await Pe(q.password),C.allDatabases=await j.getAllDatabase.request(q),ye.success("\u83B7\u53D6\u6210\u529F, \u8BF7\u9009\u62E9\u9700\u8981\u7BA1\u7406\u64CD\u4F5C\u7684\u6570\u636E\u5E93")},X=async()=>{C.pwd=await j.getDbPwd.request({id:C.form.id})},oe=async()=>{C.form.id||El(C.form.password,"\u65B0\u589E\u64CD\u4F5C\uFF0C\u5BC6\u7801\u4E0D\u53EF\u4E3A\u7A7A"),D.value.validate(async q=>{if(q){const g=De({},C.form);g.password=await Pe(g.password),j.saveDb.request(g).then(()=>{ye.success("\u4FDD\u5B58\u6210\u529F"),$("val-change",C.form),C.btnLoading=!0,setTimeout(()=>{C.btnLoading=!1},1e3),Z()})}else return ye.error("\u8BF7\u6B63\u786E\u586B\u5199\u4FE1\u606F"),!1})},ne=()=>{C.databaseList=[],C.allDatabases=[]},Z=()=>{$("update:visible",!1),$("cancel"),setTimeout(()=>{ne()},500)};return(q,g)=>{const R=f("el-form-item"),M=f("el-input"),v=f("el-option"),r=f("el-select"),w=f("el-col"),m=f("el-link"),b=f("el-popover"),V=f("el-divider"),y=f("el-checkbox"),B=f("el-form"),I=f("el-button"),x=f("el-dialog");return d(),z("div",null,[e(x,{title:Q.title,modelValue:l(J),"onUpdate:modelValue":g[15]||(g[15]=s=>ce(J)?J.value=s:null),"before-close":Z,"close-on-click-modal":!1,"destroy-on-close":!0,width:"38%"},{footer:a(()=>[he("div",Dl,[e(I,{onClick:g[14]||(g[14]=s=>Z())},{default:a(()=>[i("\u53D6 \u6D88")]),_:1}),e(I,{type:"primary",loading:l(N),onClick:oe},{default:a(()=>[i("\u786E \u5B9A")]),_:1},8,["loading"])])]),default:a(()=>[e(B,{model:l(p),ref_key:"dbForm",ref:D,rules:de,"label-width":"95px"},{default:a(()=>[e(R,{prop:"tagId",label:"\u6807\u7B7E:",required:""},{default:a(()=>[e(gl,{"tag-id":l(p).tagId,"onUpdate:tag-id":g[0]||(g[0]=s=>l(p).tagId=s),"tag-path":l(p).tagPath,"onUpdate:tag-path":g[1]||(g[1]=s=>l(p).tagPath=s),style:{width:"100%"}},null,8,["tag-id","tag-path"])]),_:1}),e(R,{prop:"name",label:"\u522B\u540D:",required:""},{default:a(()=>[e(M,{modelValue:l(p).name,"onUpdate:modelValue":g[2]||(g[2]=s=>l(p).name=s),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u522B\u540D","auto-complete":"off"},null,8,["modelValue"])]),_:1}),e(R,{prop:"type",label:"\u7C7B\u578B:",required:""},{default:a(()=>[e(r,{style:{width:"100%"},modelValue:l(p).type,"onUpdate:modelValue":g[3]||(g[3]=s=>l(p).type=s),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93\u7C7B\u578B"},{default:a(()=>[e(v,{key:"item.id",label:"mysql",value:"mysql"}),e(v,{key:"item.id",label:"postgres",value:"postgres"})]),_:1},8,["modelValue"])]),_:1}),e(R,{prop:"host",label:"host:",required:""},{default:a(()=>[e(w,{span:18},{default:a(()=>[e(M,{disabled:l(p).id!==void 0,modelValue:l(p).host,"onUpdate:modelValue":g[4]||(g[4]=s=>l(p).host=s),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u4E3B\u673Aip","auto-complete":"off"},null,8,["disabled","modelValue"])]),_:1}),e(w,{style:{"text-align":"center"},span:1},{default:a(()=>[i(":")]),_:1}),e(w,{span:5},{default:a(()=>[e(M,{type:"number",modelValue:l(p).port,"onUpdate:modelValue":g[5]||(g[5]=s=>l(p).port=s),modelModifiers:{number:!0},placeholder:"\u8BF7\u8F93\u5165\u7AEF\u53E3"},null,8,["modelValue"])]),_:1})]),_:1}),e(R,{prop:"username",label:"\u7528\u6237\u540D:",required:""},{default:a(()=>[e(M,{modelValue:l(p).username,"onUpdate:modelValue":g[6]||(g[6]=s=>l(p).username=s),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1}),e(R,{prop:"password",label:"\u5BC6\u7801:"},{default:a(()=>[e(M,{type:"password","show-password":"",modelValue:l(p).password,"onUpdate:modelValue":g[8]||(g[8]=s=>l(p).password=s),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF0C\u4FEE\u6539\u64CD\u4F5C\u53EF\u4E0D\u586B",autocomplete:"new-password"},sl({_:2},[l(p).id&&l(p).id!=0?{name:"suffix",fn:a(()=>[e(b,{onHide:g[7]||(g[7]=s=>ee.value=""),placement:"right",title:"\u539F\u5BC6\u7801",width:200,trigger:"click",content:l(ee)},{reference:a(()=>[e(m,{onClick:X,underline:!1,type:"primary",class:"mr5"},{default:a(()=>[i("\u539F\u5BC6\u7801 ")]),_:1})]),_:1},8,["content"])]),key:"0"}:void 0]),1032,["modelValue"])]),_:1}),e(R,{prop:"params",label:"\u8FDE\u63A5\u53C2\u6570:"},{default:a(()=>[e(M,{modelValue:l(p).params,"onUpdate:modelValue":g[9]||(g[9]=s=>l(p).params=s),modelModifiers:{trim:!0},placeholder:"\u5176\u4ED6\u8FDE\u63A5\u53C2\u6570\uFF0C\u5F62\u5982: key1=value1&key2=value2"},{suffix:a(()=>[e(m,{target:"_blank",href:"https://github.com/go-sql-driver/mysql#parameters",underline:!1,type:"primary",class:"mr5"},{default:a(()=>[i("\u53C2\u6570\u53C2\u8003")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(R,{prop:"database",label:"\u6570\u636E\u5E93\u540D:",required:""},{default:a(()=>[e(w,{span:19},{default:a(()=>[e(r,{onChange:U,modelValue:l(te),"onUpdate:modelValue":g[10]||(g[10]=s=>ce(te)?te.value=s:null),multiple:"",clearable:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"","allow-create":"",placeholder:"\u8BF7\u786E\u4FDD\u6570\u636E\u5E93\u5B9E\u4F8B\u4FE1\u606F\u586B\u5199\u5B8C\u6574\u540E\u83B7\u53D6\u5E93\u540D",style:{width:"100%"}},{default:a(()=>[(d(!0),z(H,null,Y(l(K),s=>(d(),_(v,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(w,{style:{"text-align":"center"},span:1},{default:a(()=>[e(V,{direction:"vertical","border-style":"dashed"})]),_:1}),e(w,{span:4},{default:a(()=>[e(m,{onClick:ue,underline:!1,type:"success"},{default:a(()=>[i("\u83B7\u53D6\u5E93\u540D")]),_:1})]),_:1})]),_:1}),e(R,{prop:"remark",label:"\u5907\u6CE8:"},{default:a(()=>[e(M,{modelValue:l(p).remark,"onUpdate:modelValue":g[11]||(g[11]=s=>l(p).remark=s),modelModifiers:{trim:!0},"auto-complete":"off",type:"textarea"},null,8,["modelValue"])]),_:1}),e(R,{prop:"enableSshTunnel",label:"SSH\u96A7\u9053:"},{default:a(()=>[e(w,{span:3},{default:a(()=>[e(y,{onChange:le,modelValue:l(p).enableSshTunnel,"onUpdate:modelValue":g[12]||(g[12]=s=>l(p).enableSshTunnel=s),"true-label":1,"false-label":-1},null,8,["modelValue"])]),_:1}),l(p).enableSshTunnel==1?(d(),_(w,{key:0,span:5},{default:a(()=>[i(" \u673A\u5668: ")]),_:1})):A("",!0),l(p).enableSshTunnel==1?(d(),_(w,{key:1,span:16},{default:a(()=>[e(r,{style:{width:"100%"},modelValue:l(p).sshTunnelMachineId,"onUpdate:modelValue":g[13]||(g[13]=s=>l(p).sshTunnelMachineId=s),placeholder:"\u8BF7\u9009\u62E9SSH\u96A7\u9053\u673A\u5668"},{default:a(()=>[(d(!0),z(H,null,Y(l(fe),s=>(d(),_(v,{key:s.id,label:`${s.ip}:${s.port} [${s.name}]`,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):A("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}}),wl=["bigint","binary","blob","char","datetime","date","decimal","double","enum","float","int","json","longblob","longtext","mediumblob","mediumtext","set","smallint","text","time","timestamp","tinyint","varbinary","varchar"],Cl=["armscii8","ascii","big5","binary","cp1250","cp1251","cp1256","cp1257","cp850","cp852","cp866","cp932","dec8","eucjpms","euckr","gb18030","gb2312","gbk","geostd8","greek","hebrew","hp8","keybcs2","koi8r","koi8u","latin1","latin2","latin5","latin7","macce","macroman","sjis","swe7","tis620","ucs2","ujis","utf16","utf16le","utf32","utf8","utf8mb4"],Fl=["unicode_ci","bin","croatian_ci","czech_ci","danish_ci","esperanto_ci","estonian_ci","general_ci","german2_ci","hungarian_ci","icelandic_ci","latvian_ci","lithuanian_ci","persian_ci","polish_ci","roman_ci","romanian_ci","sinhala_ci","slovak_ci","slovenian_ci","spanish2_ci","spanish_ci","swedish_ci","turkish_ci","unicode_520_ci","vietnamese_ci"],xl=qe({__name:"CreateTable",props:{visible:{type:Boolean},title:{type:String},data:{type:Object},dbId:{type:Number},db:{type:String}},emits:["update:visible","cancel","val-change","submit-sql"],setup(Q,{emit:$}){const t=Q,de=je(),D=Ie({dialogVisible:!1,btnloading:!1,activeName:"1",columnTypeList:wl,indexTypeList:["BTREE"],characterSetNameList:Cl,collationNameList:Fl,tableData:{fields:{colNames:[{prop:"name",label:"\u5B57\u6BB5\u540D\u79F0"},{prop:"type",label:"\u5B57\u6BB5\u7C7B\u578B"},{prop:"length",label:"\u957F\u5EA6"},{prop:"value",label:"\u9ED8\u8BA4\u503C"},{prop:"notNull",label:"\u975E\u7A7A"},{prop:"pri",label:"\u4E3B\u952E"},{prop:"auto_increment",label:"\u81EA\u589E"},{prop:"remark",label:"\u5907\u6CE8"},{prop:"action",label:"\u64CD\u4F5C"}],res:[{name:"",type:"",value:"",length:"",notNull:!1,pri:!1,auto_increment:!1,remark:""}]},indexs:{colNames:[{prop:"indexName",label:"\u7D22\u5F15\u540D"},{prop:"columnNames",label:"\u5217\u540D"},{prop:"unique",label:"\u552F\u4E00"},{prop:"indexType",label:"\u7C7B\u578B"},{prop:"indexComment",label:"\u5907\u6CE8"},{prop:"action",label:"\u64CD\u4F5C"}],columns:[{name:"",remark:""}],res:[{indexName:"",columnNames:[],unique:!1,indexType:"BTREE",indexComment:""}]},characterSet:"utf8mb4",collation:"utf8mb4_general_ci",tableName:"",tableComment:"",height:550}}),{dialogVisible:C,btnloading:J,activeName:K,columnTypeList:te,indexTypeList:fe,characterSetNameList:p,collationNameList:ee,tableData:N}=Se(D);Te(t,async v=>{D.dialogVisible=v.visible});const U=()=>{$("update:visible",!1),R()},le=()=>{D.tableData.fields.res.push({name:"",type:"",value:"",length:"",notNull:!1,pri:!1,auto_increment:!1,remark:""})},ue=()=>{D.tableData.indexs.res.push({indexName:"",columnNames:[],unique:!1,indexType:"BTREE",indexComment:""})},X=()=>{D.tableData.fields.res.push({name:"id",type:"bigint",length:"20",value:"",notNull:!0,pri:!0,auto_increment:!0,remark:"\u4E3B\u952EID"},{name:"creator_id",type:"bigint",length:"20",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u521B\u5EFA\u4EBAid"},{name:"creator",type:"varchar",length:"100",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u521B\u5EFA\u4EBA\u59D3\u540D"},{name:"creat_time",type:"datetime",length:"",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u521B\u5EFA\u65F6\u95F4"},{name:"updater_id",type:"bigint",length:"20",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u4FEE\u6539\u4EBAid"},{name:"updater",type:"varchar",length:"100",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u4FEE\u6539\u4EBA\u59D3\u540D"},{name:"update_time",type:"datetime",length:"",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u4FEE\u6539\u65F6\u95F4"})},oe=v=>{D.tableData.fields.res.splice(v,1)},ne=v=>{D.tableData.indexs.res.splice(v,1)},Z=async()=>{let v=g();if(!v){ye.warning("\u6CA1\u6709\u66F4\u6539");return}Qe({sql:v,dbId:t.dbId,db:t.db,runSuccessCallback:()=>{$("submit-sql",{tableName:D.tableData.tableName})}})},q=(v,r,w)=>{let m={del:[],add:[],upd:[]};if(v&&Array.isArray(v)&&v.length===0&&r&&Array.isArray(r)&&r.length>0)return m.add=r,m;if(r&&Array.isArray(r)&&r.length===0&&v&&Array.isArray(v)&&v.length>0)return m.del=v,m;let b={},V={};return v.forEach(y=>b[y[w]]=y),r.forEach(y=>{let B=y[w];V[B]=y,b.hasOwnProperty(B)||m.add.push(y)}),v.forEach(y=>{let B=y[w],I=V[B];if(!I)m.del.push(y);else for(let x in y){let s=y[x],re=I[x];if(s.toString()!==re.toString()){m.upd.push(I);break}}}),m},g=()=>{var w;const v=m=>{let b=m.value?m.value==="CURRENT_TIMESTAMP"?m.value:"'"+m.value+"'":"",V=`${b?"DEFAULT "+b:""}`,y=m.length?`(${m.length})`:"";return` ${m.name} ${m.type}${y} ${m.notNull?"NOT NULL":"NULL"} ${m.auto_increment?"AUTO_INCREMENT":""} ${V} comment '${m.remark||""}' `};let r=D.tableData;if((w=t.data)!=null&&w.edit){let m="",b="",V="";if(D.activeName==="1"){let y=q(M.fields,D.tableData.fields.res,"name");return y.add.length>0&&(m=`ALTER TABLE ${r.tableName}`,y.add.forEach(B=>{m+=` ADD ${v(B)},`}),m=m.substring(0,m.length-1),m+=";"),y.upd.length>0&&(b=`ALTER TABLE ${r.tableName}`,y.upd.forEach(B=>{b+=` MODIFY ${v(B)},`}),b=b.substring(0,b.length-1),b+=";"),y.del.length>0&&y.del.forEach(B=>{V+=` ALTER TABLE ${r.tableName} DROP COLUMN ${B.name}; `}),m+b+V}else if(D.activeName==="2"){let y=q(M.indexs,D.tableData.indexs.res,"indexName"),B=[],I=[];if(y.upd.length>0&&y.upd.forEach(x=>{B.push(x.indexName),I.push(x)}),y.del.length>0&&y.del.forEach(x=>{B.push(x.indexName)}),y.add.length>0&&y.add.forEach(x=>{I.push(x)}),B.length>0||I.length>0){let x=`ALTER TABLE ${r.tableName} `;return B.length>0&&(B.forEach(s=>{x+=`DROP INDEX ${s},`}),x=x.substring(0,x.length-1)),I.length>0&&(B.length>0&&(x+=","),I.forEach(s=>{x+=` ADD ${s.unique?"UNIQUE":""} INDEX ${s.indexName}(${s.columnNames.join(",")}) USING ${s.indexType} COMMENT '${s.indexComment}',`}),x=x.substring(0,x.length-1)),x}}}else if(D.activeName==="1"){let m="",b=[];return r.fields.res.forEach(V=>{b.push(v(V)),V.pri&&(m+=`${V.name},`)}),`CREATE TABLE ${r.tableName}
                  ( ${b.join(",")}
                      ${m?`, PRIMARY KEY (${m.slice(0,-1)})`:""}
                  ) ENGINE=InnoDB DEFAULT CHARSET=${r.characterSet} COLLATE =${r.collation} COMMENT='${r.tableComment}';`}else if(D.activeName==="2"&&r.indexs.res.length>0){let m=`ALTER TABLE ${r.tableName}`;return D.tableData.indexs.res.forEach(b=>{m+=` ADD ${b.unique?"UNIQUE":""} INDEX ${b.indexName}(${b.columnNames.join(",")}) USING ${b.indexType} COMMENT '${b.indexComment}',`}),m.substring(0,m.length-1)+";"}},R=()=>{D.activeName="1",de.value.resetFields(),D.tableData.tableName="",D.tableData.tableComment="",D.tableData.fields.res=[{name:"",type:"",value:"",length:"",notNull:!1,pri:!1,auto_increment:!1,remark:""}],D.tableData.indexs.res=[{indexName:"",columnNames:[],unique:!1,indexType:"BTREE",indexComment:""}]},M={indexs:[],fields:[]};return Te(()=>t.data,v=>{const{row:r,indexs:w,columns:m}=v;D.tableData.tableName=r.tableName,D.tableData.tableComment=r.tableComment,m&&Array.isArray(m)&&m.length>0&&(M.fields=[],D.tableData.fields.res=[],D.tableData.indexs.columns=[],m.forEach(b=>{var x;let V=b.columnType.replace(")","").split("("),y=V[0],B=V.length>1&&V[1]||"",I={name:b.columnName,type:y,value:b.columnDefault||"",length:B,notNull:b.nullable!=="YES",pri:b.columnKey==="PRI",auto_increment:((x=b.extra)==null?void 0:x.indexOf("auto_increment"))>-1,remark:b.columnComment};D.tableData.fields.res.push(I),M.fields.push(JSON.parse(JSON.stringify(I))),D.tableData.indexs.columns.push({name:b.columnName,remark:b.columnComment})})),w&&Array.isArray(w)&&w.length>0&&(M.indexs=[],D.tableData.indexs.res=[],w.filter(b=>b.indexName!=="PRIMARY").forEach(b=>{var y;let V={indexName:b.indexName,columnNames:(y=b.columnName)==null?void 0:y.split(","),unique:b.nonUnique===0||!1,indexType:b.indexType,indexComment:b.indexComment};D.tableData.indexs.res.push(V),M.indexs.push(JSON.parse(JSON.stringify(V)))}))}),(v,r)=>{const w=f("el-input"),m=f("el-form-item"),b=f("el-col"),V=f("el-option"),y=f("el-select"),B=f("el-row"),I=f("el-checkbox"),x=f("el-link"),s=f("el-table-column"),re=f("el-table"),me=f("el-button"),_e=f("el-tab-pane"),ve=f("el-tabs"),ge=f("el-form"),we=f("el-dialog");return d(),z("div",null,[e(we,{title:Q.title,modelValue:l(C),"onUpdate:modelValue":r[9]||(r[9]=c=>ce(C)?C.value=c:null),"before-close":U,width:"90%"},{footer:a(()=>[e(me,{loading:l(J),onClick:r[8]||(r[8]=c=>Z()),type:"primary"},{default:a(()=>[i("\u4FDD\u5B58")]),_:1},8,["loading"])]),default:a(()=>[e(ge,{"label-position":"left",ref_key:"formRef",ref:de,model:l(N),"label-width":"80px"},{default:a(()=>[e(B,null,{default:a(()=>[e(b,{span:12},{default:a(()=>[e(m,{prop:"tableName",label:"\u8868\u540D"},{default:a(()=>[e(w,{style:{width:"80%"},modelValue:l(N).tableName,"onUpdate:modelValue":r[0]||(r[0]=c=>l(N).tableName=c),size:"small"},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(m,{prop:"tableComment",label:"\u5907\u6CE8"},{default:a(()=>[e(w,{style:{width:"80%"},modelValue:l(N).tableComment,"onUpdate:modelValue":r[1]||(r[1]=c=>l(N).tableComment=c),size:"small"},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(m,{prop:"characterSet",label:"charset"},{default:a(()=>[e(y,{filterable:"",style:{width:"80%"},modelValue:l(N).characterSet,"onUpdate:modelValue":r[2]||(r[2]=c=>l(N).characterSet=c),size:"small"},{default:a(()=>[(d(!0),z(H,null,Y(l(p),c=>(d(),_(V,{key:c,label:c,value:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(m,{prop:"characterSet",label:"collation"},{default:a(()=>[e(y,{filterable:"",style:{width:"80%"},modelValue:l(N).collation,"onUpdate:modelValue":r[3]||(r[3]=c=>l(N).collation=c),size:"small"},{default:a(()=>[(d(!0),z(H,null,Y(l(ee),c=>(d(),_(V,{key:c,label:l(N).characterSet+"_"+c,value:l(N).characterSet+"_"+c},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ve,{modelValue:l(K),"onUpdate:modelValue":r[7]||(r[7]=c=>ce(K)?K.value=c:null)},{default:a(()=>[e(_e,{label:"\u5B57\u6BB5",name:"1"},{default:a(()=>[e(re,{data:l(N).fields.res,"max-height":l(N).height},{default:a(()=>[(d(!0),z(H,null,Y(l(N).fields.colNames,c=>(d(),_(s,{prop:c.prop,label:c.label,key:c.prop},{default:a(F=>[c.prop==="name"?(d(),_(w,{key:0,size:"small",modelValue:F.row.name,"onUpdate:modelValue":h=>F.row.name=h},null,8,["modelValue","onUpdate:modelValue"])):A("",!0),c.prop==="type"?(d(),_(y,{key:1,filterable:"",size:"small",modelValue:F.row.type,"onUpdate:modelValue":h=>F.row.type=h},{default:a(()=>[(d(!0),z(H,null,Y(l(te),h=>(d(),_(V,{key:h,value:h},{default:a(()=>[i(T(h),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):A("",!0),c.prop==="value"?(d(),_(w,{key:2,size:"small",modelValue:F.row.value,"onUpdate:modelValue":h=>F.row.value=h},null,8,["modelValue","onUpdate:modelValue"])):A("",!0),c.prop==="length"?(d(),_(w,{key:3,size:"small",modelValue:F.row.length,"onUpdate:modelValue":h=>F.row.length=h},null,8,["modelValue","onUpdate:modelValue"])):A("",!0),c.prop==="notNull"?(d(),_(I,{key:4,size:"small",modelValue:F.row.notNull,"onUpdate:modelValue":h=>F.row.notNull=h},null,8,["modelValue","onUpdate:modelValue"])):A("",!0),c.prop==="pri"?(d(),_(I,{key:5,size:"small",modelValue:F.row.pri,"onUpdate:modelValue":h=>F.row.pri=h},null,8,["modelValue","onUpdate:modelValue"])):A("",!0),c.prop==="auto_increment"?(d(),_(I,{key:6,size:"small",modelValue:F.row.auto_increment,"onUpdate:modelValue":h=>F.row.auto_increment=h},null,8,["modelValue","onUpdate:modelValue"])):A("",!0),c.prop==="remark"?(d(),_(w,{key:7,size:"small",modelValue:F.row.remark,"onUpdate:modelValue":h=>F.row.remark=h},null,8,["modelValue","onUpdate:modelValue"])):A("",!0),c.prop==="action"?(d(),_(x,{key:8,type:"danger",plain:"",size:"small",underline:!1,onClick:se(h=>oe(F.$index),["prevent"])},{default:a(()=>[i("\u5220\u9664")]),_:2},1032,["onClick"])):A("",!0)]),_:2},1032,["prop","label"]))),128))]),_:1},8,["data","max-height"]),e(B,{style:{"margin-top":"20px"}},{default:a(()=>[e(me,{onClick:r[4]||(r[4]=c=>X()),link:"",type:"warning",icon:"plus"},{default:a(()=>[i("\u6DFB\u52A0\u9ED8\u8BA4\u5217")]),_:1}),e(me,{onClick:r[5]||(r[5]=c=>le()),link:"",type:"primary",icon:"plus"},{default:a(()=>[i("\u6DFB\u52A0\u5217")]),_:1})]),_:1})]),_:1}),e(_e,{label:"\u7D22\u5F15",name:"2"},{default:a(()=>[e(re,{data:l(N).indexs.res,"max-height":l(N).height},{default:a(()=>[(d(!0),z(H,null,Y(l(N).indexs.colNames,c=>(d(),_(s,{prop:c.prop,label:c.label,key:c.prop},{default:a(F=>[c.prop==="indexName"?(d(),_(w,{key:0,size:"small",modelValue:F.row.indexName,"onUpdate:modelValue":h=>F.row.indexName=h},null,8,["modelValue","onUpdate:modelValue"])):A("",!0),c.prop==="columnNames"?(d(),_(y,{key:1,modelValue:F.row.columnNames,"onUpdate:modelValue":h=>F.row.columnNames=h,multiple:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5",style:{width:"100%"}},{default:a(()=>[(d(!0),z(H,null,Y(l(N).indexs.columns,h=>(d(),_(V,{key:h.name,label:h.name,value:h.name},{default:a(()=>[i(T(h.name+" - "+(h.remark||"")),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):A("",!0),c.prop==="unique"?(d(),_(I,{key:2,size:"small",modelValue:F.row.unique,"onUpdate:modelValue":h=>F.row.unique=h},null,8,["modelValue","onUpdate:modelValue"])):A("",!0),c.prop==="indexType"?(d(),_(y,{key:3,filterable:"",size:"small",modelValue:F.row.indexType,"onUpdate:modelValue":h=>F.row.indexType=h},{default:a(()=>[(d(!0),z(H,null,Y(l(fe),h=>(d(),_(V,{key:h,value:h},{default:a(()=>[i(T(h),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):A("",!0),c.prop==="indexComment"?(d(),_(w,{key:4,size:"small",modelValue:F.row.indexComment,"onUpdate:modelValue":h=>F.row.indexComment=h},null,8,["modelValue","onUpdate:modelValue"])):A("",!0),c.prop==="action"?(d(),_(x,{key:5,type:"danger",plain:"",size:"small",underline:!1,onClick:se(h=>ne(F.$index),["prevent"])},{default:a(()=>[i("\u5220\u9664")]),_:2},1032,["onClick"])):A("",!0)]),_:2},1032,["prop","label"]))),128))]),_:1},8,["data","max-height"]),e(B,{style:{"margin-top":"20px"}},{default:a(()=>[e(me,{onClick:r[6]||(r[6]=c=>ue()),link:"",type:"primary",icon:"plus"},{default:a(()=>[i("\u6DFB\u52A0\u7D22\u5F15")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});var ae={DbSqlExecTypeEnum:new yl().add("UPDATE","UPDATE",1).add("DELETE","DELETE",2).add("INSERT","INSERT",3)};const Vl={class:"db-list"},Bl={style:{float:"right"}},Nl=he("i",null,null,-1),kl={style:{"text-align":"right"}},Tl={class:"toolbar"},Pl=qe({__name:"DbList",setup(Q){const $={saveDb:"db:save",delDb:"db:del"},t=Ie({row:{},dbId:0,db:"",tags:[],chooseId:null,chooseData:null,query:{tagPath:null,projectId:null,pageNum:1,pageSize:10},datas:[],total:0,infoDialog:{visible:!1,data:null},showDumpInfo:!1,dumpInfo:{id:0,db:"",type:3,tables:[]},sqlExecLogDialog:{title:"",visible:!1,data:[],total:0,dbs:[],query:{dbId:0,db:"",table:"",type:null,pageNum:1,pageSize:12}},rollbackSqlDialog:{visible:!1,sql:""},chooseTableName:"",tableInfoDialog:{loading:!1,visible:!1,infos:[],tableNameSearch:"",tableCommentSearch:""},columnDialog:{visible:!1,columns:[]},indexDialog:{visible:!1,indexs:[]},ddlDialog:{visible:!1,ddl:""},dbEditDialog:{visible:!1,data:null,title:"\u65B0\u589E\u6570\u636E\u5E93"},tableCreateDialog:{title:"\u521B\u5EFA\u8868",visible:!1,activeName:"1",type:"",enableEditTypes:["mysql"],data:{edit:!1,row:{},indexs:[],columns:[]}},filterDb:{param:"",cache:[],list:[]}}),{dbId:de,db:D,tags:C,chooseId:J,query:K,datas:te,total:fe,infoDialog:p,showDumpInfo:ee,dumpInfo:N,sqlExecLogDialog:U,rollbackSqlDialog:le,chooseTableName:ue,tableInfoDialog:X,columnDialog:oe,indexDialog:ne,ddlDialog:Z,dbEditDialog:q,tableCreateDialog:g,filterDb:R}=Se(t);dl(async()=>{r()});const M=rl(()=>{const n=t.tableInfoDialog.infos,o=t.tableInfoDialog.tableNameSearch,S=t.tableInfoDialog.tableCommentSearch;return!o&&!S?n:n.filter(W=>{let G=!0,O=!0;return o&&(G=W.tableName.toLowerCase().includes(o.toLowerCase())),S&&(O=W.tableComment.includes(S)),G&&O})}),v=n=>{!n||(t.chooseId=n.id,t.chooseData=n)},r=async()=>{let n=await j.dbs.request(t.query);n.list.forEach(o=>{o.popoverSelectDbVisible=!1,o.dbs=o.database.split(" ")}),t.datas=n.list,t.total=n.total},w=n=>{t.query.pageNum=n,r()},m=n=>{t.infoDialog.data=n,t.infoDialog.visible=!0},b=async()=>{t.tags=await _l.getAccountTags.request(null)},V=async(n=!1)=>{n?(t.dbEditDialog.data=null,t.dbEditDialog.title="\u65B0\u589E\u6570\u636E\u5E93\u8D44\u6E90"):(t.dbEditDialog.data=t.chooseData,t.dbEditDialog.title="\u4FEE\u6539\u6570\u636E\u5E93\u8D44\u6E90"),t.dbEditDialog.visible=!0},y=()=>{t.chooseData=null,t.chooseId=null,r()},B=async n=>{try{await Re.confirm("\u786E\u5B9A\u5220\u9664\u8BE5\u5E93?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await j.deleteDb.request({id:n}),ye.success("\u5220\u9664\u6210\u529F"),t.chooseData=null,t.chooseId=null,r()}catch{}},I=async n=>{t.sqlExecLogDialog.title=`${n.name}[${n.host}:${n.port}]`,t.sqlExecLogDialog.query.dbId=n.id,t.sqlExecLogDialog.dbs=n.database.split(" "),s(),t.sqlExecLogDialog.visible=!0},x=()=>{t.sqlExecLogDialog.visible=!1,t.sqlExecLogDialog.data=[],t.sqlExecLogDialog.dbs=[],t.sqlExecLogDialog.total=0,t.sqlExecLogDialog.query.dbId=0,t.sqlExecLogDialog.query.pageNum=1,t.sqlExecLogDialog.query.table="",t.sqlExecLogDialog.query.db="",t.sqlExecLogDialog.query.type=null},s=async()=>{const n=await j.getSqlExecs.request(t.sqlExecLogDialog.query);t.sqlExecLogDialog.data=n.list,t.sqlExecLogDialog.total=n.total},re=n=>{t.sqlExecLogDialog.query.pageNum=n,s()},me=n=>{t.dumpInfo.tables=n.map(o=>o.tableName)},_e=n=>{hl(t.dumpInfo.tables.length>0,"\u8BF7\u9009\u62E9\u8981\u5BFC\u51FA\u7684\u8868");const o=document.createElement("a");o.setAttribute("href",`${pl.baseApiUrl}/dbs/${t.dbId}/dump?db=${n}&type=${t.dumpInfo.type}&tables=${t.dumpInfo.tables.join(",")}&token=${bl("token")}`),o.click(),t.showDumpInfo=!1},ve=async n=>{const o=await j.columnMetadata.request({id:n.dbId,db:n.db,tableName:n.table}),S=o[0].columnName,W=JSON.parse(n.oldValue),G=[];if(n.type==ae.DbSqlExecTypeEnum.UPDATE.value)for(let O of W){const E=[];for(let L in O)L!=S&&E.push(`${L} = ${ge(O[L])}`);G.push(`UPDATE ${n.table} SET ${E.join(", ")} WHERE ${S} = ${ge(O[S])};`)}else if(n.type==ae.DbSqlExecTypeEnum.DELETE.value){const O=o.map(E=>E.columnName);for(let E of W){const L=[];for(let Fe of O)L.push(ge(E[Fe]));G.push(`INSERT INTO ${n.table} (${O.join(", ")}) VALUES (${L.join(", ")});`)}}t.rollbackSqlDialog.sql=G.join(`
`),t.rollbackSqlDialog.visible=!0},ge=n=>typeof n=="number"?n:`'${n}'`,we=async(n,o)=>{t.tableInfoDialog.loading=!0,t.tableInfoDialog.visible=!0;try{t.tableInfoDialog.infos=await j.tableInfos.request({id:n.id,db:o}),t.tableCreateDialog.type=n.type,t.dbId=n.id,t.row=n,t.db=o}catch{t.tableInfoDialog.visible=!1}finally{t.tableInfoDialog.loading=!1}},c=async n=>{await Ce(n),t.tableInfoDialog.infos=await j.tableInfos.request({id:t.dbId,db:t.db})},F=()=>{t.showDumpInfo=!1,t.tableInfoDialog.visible=!1,t.tableInfoDialog.infos=[]},h=async n=>{t.chooseTableName=n.tableName,t.columnDialog.columns=await j.columnMetadata.request({id:t.chooseId,db:t.db,tableName:n.tableName}),t.columnDialog.visible=!0},He=async n=>{t.chooseTableName=n.tableName,t.indexDialog.indexs=await j.tableIndex.request({id:t.chooseId,db:t.db,tableName:n.tableName}),t.indexDialog.visible=!0},Ye=async n=>{t.chooseTableName=n.tableName;const o=await j.tableDdl.request({id:t.chooseId,db:t.db,tableName:n.tableName});t.ddlDialog.ddl=o[0]["Create Table"],t.ddlDialog.visible=!0},Je=async n=>{try{const o=n.tableName;await Re.confirm(`\u786E\u5B9A\u5220\u9664'${o}'\u8868?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),Qe({sql:`DROP TABLE ${o}`,dbId:t.chooseId,db:t.db,runSuccessCallback:async()=>{t.tableInfoDialog.infos=await j.tableInfos.request({id:t.chooseId,db:t.db})}})}catch{}},Xe=(n,o)=>{let S=Me.state.sqlExecInfo.dbOptInfo.db;if(o&&S!==o){const{tagPath:W,id:G}=n;let O={tagPath:W,dbId:G,db:o};Me.dispatch("sqlExecInfo/setSqlExecInfo",O)}cl.push({name:"SqlExec"})},Ge=n=>{t.filterDb.param="",t.filterDb.cache=n,t.filterDb.list=n},Ke=()=>{t.filterDb.param?t.filterDb.list=t.filterDb.cache.filter(n=>String(n).toLowerCase().indexOf(t.filterDb.param)>-1):t.filterDb.list=t.filterDb.cache},Ce=async n=>{if(t.tableCreateDialog.visible=!0,t.tableCreateDialog.activeName="1",n===!1&&(t.tableCreateDialog.data={edit:!1,row:{},indexs:[],columns:[]},t.tableCreateDialog.title="\u521B\u5EFA\u8868"),n.tableName){t.tableCreateDialog.title="\u4FEE\u6539\u8868";let o=await j.tableIndex.request({id:t.chooseId,db:t.db,tableName:n.tableName}),S=await j.columnMetadata.request({id:t.chooseId,db:t.db,tableName:n.tableName});t.tableCreateDialog.data={edit:!0,row:n,indexs:o,columns:S}}};return(n,o)=>{const S=f("el-button"),W=f("el-option"),G=f("el-select"),O=f("el-radio"),E=f("el-table-column"),L=f("el-link"),Fe=f("el-icon"),pe=f("el-input"),Ae=f("el-popover"),We=f("el-divider"),be=f("el-table"),$e=f("el-pagination"),xe=f("el-row"),Ze=f("el-card"),el=f("el-radio-group"),Ue=f("el-form-item"),ie=f("el-dialog"),Ve=f("el-tag"),P=f("el-descriptions-item"),ll=f("el-descriptions"),Be=Ne("auth"),al=Ne("waves"),tl=Ne("loading");return d(),z("div",Vl,[e(Ze,null,{default:a(()=>[Ee((d(),_(S,{type:"primary",icon:"plus",onClick:o[0]||(o[0]=u=>V(!0))},{default:a(()=>[i("\u6DFB\u52A0")]),_:1})),[[Be,$.saveDb]]),Ee((d(),_(S,{disabled:l(J)==null,onClick:o[1]||(o[1]=u=>V(!1)),type:"primary",icon:"edit"},{default:a(()=>[i("\u7F16\u8F91")]),_:1},8,["disabled"])),[[Be,$.saveDb]]),Ee((d(),_(S,{disabled:l(J)==null,onClick:o[2]||(o[2]=u=>B(l(J))),type:"danger",icon:"delete"},{default:a(()=>[i("\u5220\u9664")]),_:1},8,["disabled"])),[[Be,$.delDb]]),he("div",Bl,[e(G,{onFocus:b,modelValue:l(K).tagPath,"onUpdate:modelValue":o[3]||(o[3]=u=>l(K).tagPath=u),placeholder:"\u8BF7\u9009\u62E9\u6807\u7B7E",filterable:"",clearable:""},{default:a(()=>[(d(!0),z(H,null,Y(l(C),u=>(d(),_(W,{key:u,label:u,value:u},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Ee((d(),_(S,{type:"primary",icon:"search",onClick:o[4]||(o[4]=u=>r()),class:"ml5"},{default:a(()=>[i("\u67E5\u8BE2")]),_:1})),[[al]])]),e(be,{data:l(te),ref:"table",onCurrentChange:v,"show-overflow-tooltip":"",stripe:""},{default:a(()=>[e(E,{label:"\u9009\u62E9",width:"60px"},{default:a(u=>[e(O,{modelValue:l(J),"onUpdate:modelValue":o[5]||(o[5]=k=>ce(J)?J.value=k:null),label:u.row.id},{default:a(()=>[Nl]),_:2},1032,["modelValue","label"])]),_:1}),e(E,{prop:"tagPath",label:"\u6807\u7B7E\u8DEF\u5F84","min-width":"150","show-overflow-tooltip":""}),e(E,{prop:"name",label:"\u540D\u79F0","min-width":"160","show-overflow-tooltip":""}),e(E,{"min-width":"170",label:"host:port","show-overflow-tooltip":""},{default:a(u=>[i(T(`${u.row.host}:${u.row.port}`),1)]),_:1}),e(E,{prop:"type",label:"\u7C7B\u578B","min-width":"90"}),e(E,{prop:"database",label:"\u6570\u636E\u5E93","min-width":"80"},{default:a(u=>[e(Ae,{placement:"right",trigger:"click",width:300},{reference:a(()=>[e(L,{type:"primary",underline:!1,plain:"",onClick:k=>Ge(u.row.dbs)},{default:a(()=>[i("\u67E5\u770B ")]),_:2},1032,["onClick"])]),default:a(()=>[e(pe,{modelValue:l(R).param,"onUpdate:modelValue":o[6]||(o[6]=k=>l(R).param=k),onKeyup:Ke,class:"w-50 m-2",placeholder:"\u641C\u7D22",size:"small"},{prefix:a(()=>[e(Fe,{class:"el-input__icon"},{default:a(()=>[e(l(ml))]),_:1})]),_:1},8,["modelValue"]),(d(!0),z(H,null,Y(l(R).list,k=>(d(),z("div",{class:"el-tag--plain el-tag--success",key:k,style:{border:"1px var(--color-success-light-3) solid","margin-top":"3px","border-radius":"5px",padding:"2px",position:"relative"}},[e(L,{type:"success",plain:"",size:"small",underline:!1,onClick:ul=>we(u.row,k)},{default:a(()=>[i(T(k),1)]),_:2},1032,["onClick"]),e(L,{type:"primary",plain:"",size:"small",underline:!1,onClick:ul=>Xe(u.row,k),style:{position:"absolute",right:"4px"}},{default:a(()=>[i("\u6570\u636E\u64CD\u4F5C ")]),_:2},1032,["onClick"])]))),128))]),_:2},1024)]),_:1}),e(E,{prop:"username",label:"\u7528\u6237\u540D","min-width":"100"}),e(E,{prop:"remark",label:"\u5907\u6CE8","min-width":"150","show-overflow-tooltip":""}),e(E,{label:"\u64CD\u4F5C","min-width":"160",fixed:"right"},{default:a(u=>[e(L,{plain:"",size:"small",underline:!1,onClick:k=>m(u.row)},{default:a(()=>[i(" \u8BE6\u60C5")]),_:2},1032,["onClick"]),e(We,{direction:"vertical","border-style":"dashed"}),e(L,{class:"ml5",type:"primary",plain:"",size:"small",underline:!1,onClick:k=>I(u.row)},{default:a(()=>[i(" SQL\u6267\u884C\u8BB0\u5F55")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(xe,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:a(()=>[e($e,{style:{"text-align":"right"},onCurrentChange:w,total:l(fe),layout:"prev, pager, next, total, jumper","current-page":l(K).pageNum,"onUpdate:current-page":o[7]||(o[7]=u=>l(K).pageNum=u),"page-size":l(K).pageSize},null,8,["total","current-page","page-size"])]),_:1})]),_:1}),e(ie,{width:"80%",title:`${l(D)} \u8868\u4FE1\u606F`,"before-close":F,modelValue:l(X).visible,"onUpdate:modelValue":o[15]||(o[15]=u=>l(X).visible=u)},{default:a(()=>[e(xe,{class:"mb10"},{default:a(()=>[e(Ae,{visible:l(ee),"onUpdate:visible":o[11]||(o[11]=u=>ce(ee)?ee.value=u:null),width:470,placement:"right",trigger:"click"},{reference:a(()=>[e(S,{class:"ml5",type:"success",size:"small"},{default:a(()=>[i("\u5BFC\u51FA")]),_:1})]),default:a(()=>[e(Ue,{label:"\u5BFC\u51FA\u5185\u5BB9: "},{default:a(()=>[e(el,{modelValue:l(N).type,"onUpdate:modelValue":o[8]||(o[8]=u=>l(N).type=u)},{default:a(()=>[e(O,{label:1,size:"small"},{default:a(()=>[i("\u7ED3\u6784")]),_:1}),e(O,{label:2,size:"small"},{default:a(()=>[i("\u6570\u636E")]),_:1}),e(O,{label:3,size:"small"},{default:a(()=>[i("\u7ED3\u6784\uFF0B\u6570\u636E")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(Ue,{label:"\u5BFC\u51FA\u8868: "},{default:a(()=>[e(be,{onSelectionChange:me,"max-height":"300",size:"small",data:l(X).infos},{default:a(()=>[e(E,{type:"selection",width:"45"}),e(E,{property:"tableName",label:"\u8868\u540D","min-width":"150","show-overflow-tooltip":""}),e(E,{property:"tableComment",label:"\u5907\u6CE8","min-width":"150","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1}),he("div",kl,[e(S,{onClick:o[9]||(o[9]=u=>ee.value=!1),size:"small"},{default:a(()=>[i("\u53D6\u6D88")]),_:1}),e(S,{onClick:o[10]||(o[10]=u=>_e(l(D))),type:"success",size:"small"},{default:a(()=>[i("\u786E\u5B9A")]),_:1})])]),_:1},8,["visible"]),e(S,{type:"primary",size:"small",onClick:o[12]||(o[12]=u=>Ce(!1))},{default:a(()=>[i("\u521B\u5EFA\u8868")]),_:1})]),_:1}),Ee((d(),_(be,{border:"",stripe:"",data:l(M),size:"small","max-height":"680"},{default:a(()=>[e(E,{property:"tableName",label:"\u8868\u540D","min-width":"150","show-overflow-tooltip":""},{header:a(()=>[e(pe,{modelValue:l(X).tableNameSearch,"onUpdate:modelValue":o[13]||(o[13]=u=>l(X).tableNameSearch=u),size:"small",placeholder:"\u8868\u540D: \u8F93\u5165\u53EF\u8FC7\u6EE4",clearable:""},null,8,["modelValue"])]),_:1}),e(E,{property:"tableComment",label:"\u5907\u6CE8","min-width":"150","show-overflow-tooltip":""},{header:a(()=>[e(pe,{modelValue:l(X).tableCommentSearch,"onUpdate:modelValue":o[14]||(o[14]=u=>l(X).tableCommentSearch=u),size:"small",placeholder:"\u5907\u6CE8: \u8F93\u5165\u53EF\u8FC7\u6EE4",clearable:""},null,8,["modelValue"])]),_:1}),e(E,{prop:"tableRows",label:"Rows","min-width":"70",sortable:"","sort-method":(u,k)=>parseInt(u.tableRows)-parseInt(k.tableRows)},null,8,["sort-method"]),e(E,{property:"dataLength",label:"\u6570\u636E\u5927\u5C0F",sortable:"","sort-method":(u,k)=>parseInt(u.dataLength)-parseInt(k.dataLength)},{default:a(u=>[i(T(l(Oe)(u.row.dataLength)),1)]),_:1},8,["sort-method"]),e(E,{property:"indexLength",label:"\u7D22\u5F15\u5927\u5C0F",sortable:"","sort-method":(u,k)=>parseInt(u.indexLength)-parseInt(k.indexLength)},{default:a(u=>[i(T(l(Oe)(u.row.indexLength)),1)]),_:1},8,["sort-method"]),e(E,{property:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","min-width":"150"}),e(E,{label:"\u66F4\u591A\u4FE1\u606F","min-width":"140"},{default:a(u=>[e(L,{onClick:se(k=>h(u.row),["prevent"]),type:"primary"},{default:a(()=>[i("\u5B57\u6BB5")]),_:2},1032,["onClick"]),e(L,{class:"ml5",onClick:se(k=>He(u.row),["prevent"]),type:"success"},{default:a(()=>[i("\u7D22\u5F15")]),_:2},1032,["onClick"]),l(g).enableEditTypes.indexOf(l(g).type)>-1?(d(),_(L,{key:0,class:"ml5",onClick:se(k=>Ce(u.row),["prevent"]),type:"warning"},{default:a(()=>[i("\u7F16\u8F91\u8868")]),_:2},1032,["onClick"])):A("",!0),e(L,{class:"ml5",onClick:se(k=>Ye(u.row),["prevent"]),type:"info"},{default:a(()=>[i("DDL")]),_:2},1032,["onClick"])]),_:1}),e(E,{label:"\u64CD\u4F5C","min-width":"80"},{default:a(u=>[e(L,{onClick:se(k=>Je(u.row),["prevent"]),type:"danger"},{default:a(()=>[i("\u5220\u9664")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[tl,l(X).loading]])]),_:1},8,["title","modelValue"]),e(ie,{width:"90%",title:`${l(U).title} - SQL\u6267\u884C\u8BB0\u5F55`,"before-close":x,modelValue:l(U).visible,"onUpdate:modelValue":o[20]||(o[20]=u=>l(U).visible=u)},{default:a(()=>[he("div",Tl,[e(G,{modelValue:l(U).query.db,"onUpdate:modelValue":o[16]||(o[16]=u=>l(U).query.db=u),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93",filterable:"",clearable:""},{default:a(()=>[(d(!0),z(H,null,Y(l(U).dbs,u=>(d(),_(W,{key:u,label:`${u}`,value:u},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(pe,{modelValue:l(U).query.table,"onUpdate:modelValue":o[17]||(o[17]=u=>l(U).query.table=u),placeholder:"\u8BF7\u8F93\u5165\u8868\u540D",clearable:"",class:"ml5",style:{width:"180px"}},null,8,["modelValue"]),e(G,{modelValue:l(U).query.type,"onUpdate:modelValue":o[18]||(o[18]=u=>l(U).query.type=u),placeholder:"\u8BF7\u9009\u62E9\u64CD\u4F5C\u7C7B\u578B",clearable:"",class:"ml5"},{default:a(()=>[(d(!0),z(H,null,Y(l(ae).DbSqlExecTypeEnum,u=>(d(),_(W,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(S,{class:"ml5",onClick:s,type:"success",icon:"search"})]),e(be,{border:"",stripe:"",data:l(U).data,size:"small"},{default:a(()=>[e(E,{prop:"db",label:"\u6570\u636E\u5E93","min-width":"60","show-overflow-tooltip":""}),e(E,{prop:"table",label:"\u8868","min-width":"60","show-overflow-tooltip":""}),e(E,{prop:"type",label:"\u7C7B\u578B",width:"85","show-overflow-tooltip":""},{default:a(u=>[u.row.type==l(ae).DbSqlExecTypeEnum.UPDATE.value?(d(),_(Ve,{key:0,color:"#E4F5EB",size:"small"},{default:a(()=>[i("UPDATE")]),_:1})):A("",!0),u.row.type==l(ae).DbSqlExecTypeEnum.DELETE.value?(d(),_(Ve,{key:1,color:"#F9E2AE",size:"small"},{default:a(()=>[i("DELETE")]),_:1})):A("",!0),u.row.type==l(ae).DbSqlExecTypeEnum.INSERT.value?(d(),_(Ve,{key:2,color:"#A8DEE0",size:"small"},{default:a(()=>[i("INSERT")]),_:1})):A("",!0)]),_:1}),e(E,{prop:"sql",label:"SQL","min-width":"230","show-overflow-tooltip":""}),e(E,{prop:"oldValue",label:"\u539F\u503C","min-width":"150","show-overflow-tooltip":""}),e(E,{prop:"creator",label:"\u6267\u884C\u4EBA","min-width":"60","show-overflow-tooltip":""}),e(E,{prop:"createTime",label:"\u6267\u884C\u65F6\u95F4","show-overflow-tooltip":""},{default:a(u=>[i(T(l(ke)(u.row.createTime)),1)]),_:1}),e(E,{prop:"remark",label:"\u5907\u6CE8","min-width":"60","show-overflow-tooltip":""}),e(E,{label:"\u64CD\u4F5C","min-width":"50",fixed:"right"},{default:a(u=>[u.row.type==l(ae).DbSqlExecTypeEnum.UPDATE.value||u.row.type==l(ae).DbSqlExecTypeEnum.DELETE.value?(d(),_(L,{key:0,type:"primary",plain:"",size:"small",underline:!1,onClick:k=>ve(u.row)},{default:a(()=>[i(" \u8FD8\u539FSQL")]),_:2},1032,["onClick"])):A("",!0)]),_:1})]),_:1},8,["data"]),e(xe,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:a(()=>[e($e,{style:{"text-align":"right"},onCurrentChange:re,total:l(U).total,layout:"prev, pager, next, total, jumper","current-page":l(U).query.pageNum,"onUpdate:current-page":o[19]||(o[19]=u=>l(U).query.pageNum=u),"page-size":l(U).query.pageSize},null,8,["total","current-page","page-size"])]),_:1})]),_:1},8,["title","modelValue"]),e(ie,{width:"55%",title:"\u8FD8\u539FSQL",modelValue:l(le).visible,"onUpdate:modelValue":o[22]||(o[22]=u=>l(le).visible=u)},{default:a(()=>[e(pe,{type:"textarea",autosize:{minRows:15,maxRows:30},modelValue:l(le).sql,"onUpdate:modelValue":o[21]||(o[21]=u=>l(le).sql=u),size:"small"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(ie,{width:"40%",title:`${l(ue)} \u5B57\u6BB5\u4FE1\u606F`,modelValue:l(oe).visible,"onUpdate:modelValue":o[23]||(o[23]=u=>l(oe).visible=u)},{default:a(()=>[e(be,{border:"",stripe:"",data:l(oe).columns,size:"small"},{default:a(()=>[e(E,{prop:"columnName",label:"\u540D\u79F0","show-overflow-tooltip":""}),e(E,{width:"120",prop:"columnType",label:"\u7C7B\u578B","show-overflow-tooltip":""}),e(E,{width:"80",prop:"nullable",label:"\u662F\u5426\u53EF\u4E3A\u7A7A","show-overflow-tooltip":""}),e(E,{prop:"columnComment",label:"\u5907\u6CE8","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1},8,["title","modelValue"]),e(ie,{width:"40%",title:`${l(ue)} \u7D22\u5F15\u4FE1\u606F`,modelValue:l(ne).visible,"onUpdate:modelValue":o[24]||(o[24]=u=>l(ne).visible=u)},{default:a(()=>[e(be,{border:"",stripe:"",data:l(ne).indexs,size:"small"},{default:a(()=>[e(E,{prop:"indexName",label:"\u7D22\u5F15\u540D","min-width":"120","show-overflow-tooltip":""}),e(E,{prop:"columnName",label:"\u5217\u540D","min-width":"120","show-overflow-tooltip":""}),e(E,{prop:"seqInIndex",label:"\u5217\u5E8F\u5217\u53F7","show-overflow-tooltip":""}),e(E,{prop:"indexType",label:"\u7C7B\u578B"}),e(E,{prop:"indexComment",label:"\u5907\u6CE8","min-width":"130","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1},8,["title","modelValue"]),e(ie,{width:"55%",title:`${l(ue)} Create-DDL`,modelValue:l(Z).visible,"onUpdate:modelValue":o[26]||(o[26]=u=>l(Z).visible=u)},{default:a(()=>[e(pe,{disabled:"",type:"textarea",autosize:{minRows:15,maxRows:30},modelValue:l(Z).ddl,"onUpdate:modelValue":o[25]||(o[25]=u=>l(Z).ddl=u),size:"small"},null,8,["modelValue"])]),_:1},8,["title","modelValue"]),e(ie,{modelValue:l(p).visible,"onUpdate:modelValue":o[27]||(o[27]=u=>l(p).visible=u)},{default:a(()=>[e(ll,{title:"\u8BE6\u60C5",column:3,border:""},{default:a(()=>[e(P,{span:1.5,label:"id"},{default:a(()=>[i(T(l(p).data.id),1)]),_:1},8,["span"]),e(P,{span:1.5,label:"\u540D\u79F0"},{default:a(()=>[i(T(l(p).data.name),1)]),_:1},8,["span"]),e(P,{span:3,label:"\u6807\u7B7E\u8DEF\u5F84"},{default:a(()=>[i(T(l(p).data.tagPath),1)]),_:1}),e(P,{span:2,label:"\u4E3B\u673A"},{default:a(()=>[i(T(l(p).data.host),1)]),_:1}),e(P,{span:1,label:"\u7AEF\u53E3"},{default:a(()=>[i(T(l(p).data.port),1)]),_:1}),e(P,{span:2,label:"\u7528\u6237\u540D"},{default:a(()=>[i(T(l(p).data.username),1)]),_:1}),e(P,{span:1,label:"\u7C7B\u578B"},{default:a(()=>[i(T(l(p).data.type),1)]),_:1}),e(P,{span:3,label:"\u8FDE\u63A5\u53C2\u6570"},{default:a(()=>[i(T(l(p).data.params),1)]),_:1}),e(P,{span:3,label:"\u5907\u6CE8"},{default:a(()=>[i(T(l(p).data.remark),1)]),_:1}),e(P,{span:3,label:"\u6570\u636E\u5E93"},{default:a(()=>[i(T(l(p).data.database),1)]),_:1}),e(P,{span:3,label:"SSH\u96A7\u9053"},{default:a(()=>[i(T(l(p).data.enableSshTunnel==1?"\u662F":"\u5426"),1)]),_:1}),e(P,{span:2,label:"\u521B\u5EFA\u65F6\u95F4"},{default:a(()=>[i(T(l(ke)(l(p).data.createTime)),1)]),_:1}),e(P,{span:1,label:"\u521B\u5EFA\u8005"},{default:a(()=>[i(T(l(p).data.creator),1)]),_:1}),e(P,{span:2,label:"\u66F4\u65B0\u65F6\u95F4"},{default:a(()=>[i(T(l(ke)(l(p).data.updateTime)),1)]),_:1}),e(P,{span:1,label:"\u4FEE\u6539\u8005"},{default:a(()=>[i(T(l(p).data.modifier),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(vl,{onValChange:y,title:l(q).title,visible:l(q).visible,"onUpdate:visible":o[28]||(o[28]=u=>l(q).visible=u),db:l(q).data,"onUpdate:db":o[29]||(o[29]=u=>l(q).data=u)},null,8,["title","visible","db"]),e(xl,{title:l(g).title,"active-name":l(g).activeName,dbId:l(de),db:l(D),data:l(g).data,visible:l(g).visible,"onUpdate:visible":o[30]||(o[30]=u=>l(g).visible=u),onSubmitSql:c},null,8,["title","active-name","dbId","db","data","visible"])])}}});export{Pl as default};
