var de=Object.defineProperty;var Z=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var ee=(f,a,i)=>a in f?de(f,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[a]=i,te=(f,a)=>{for(var i in a||(a={}))ce.call(a,i)&&ee(f,i,a[i]);if(Z)for(var i of Z(a))pe.call(a,i)&&ee(f,i,a[i]);return f};import{d as W,r as ae,c as H,t as J,L as ue,h as r,i as D,j as O,k as l,w as u,q as T,v as c,l as e,F as M,G as K,E as L,m as B,s as S,e as me,V as fe,I,U as G,a1 as le,W as ge}from"./index.7802fdb0.js";import{b as $,a as be}from"./api.d515375d.js";import{e as oe}from"./enums.eff18c1f.js";import"./Api.3111dcb4.js";import"./Enum.48e42737.js";const _e={class:"account-dialog"},ve={class:"toolbar"},De={style:{float:"left"}},ye={class:"dialog-footer"},we=W({__name:"RoleEdit",props:{visible:{type:Boolean},account:Object},emits:["update:visible","cancel","val-change"],setup(f,{emit:a}){const i=f,y=ae(null),g=H({dialogVisible:!1,btnLoading:!1,allRole:[],query:{name:null,pageNum:1,pageSize:5},total:0}),{dialogVisible:p,btnLoading:C,allRole:k,query:m,total:E}=J(g);let h=[];ue(i,s=>{g.dialogVisible=s.visible,g.dialogVisible&&s.account&&s.account.id!=0&&$.roleIds.request({id:i.account.id}).then(d=>{h=d||[],q()})});const w=()=>{q()},V=s=>s.code.indexOf("COMMON")!=0,b=(s,d)=>{if(h.includes(d.id)){for(let n=0;n<h.length;n++)if(h[n]===d.id){h.splice(n,1);break}}else h.push(d.id)},R=()=>{setTimeout(()=>{y.value.clearSelection(),g.allRole.forEach(s=>{h.includes(s.id)&&y.value.toggleRowSelection(s,!0)})},50)},U=async()=>{let s=h.join(",");await $.saveRoles.request({id:i.account.id,roleIds:s}),L.success("\u4FDD\u5B58\u6210\u529F!"),A()},A=()=>{g.query.pageNum=1,g.query.name=null,a("update:visible",!1),a("cancel")},N=()=>{g.query.pageNum=1,g.query.name=null,q()},q=async()=>{let s=await be.list.request(g.query);g.allRole=s.list,g.total=s.total,R()};return(s,d)=>{const n=r("el-input"),t=r("el-button"),_=r("el-table-column"),j=r("el-table"),P=r("el-pagination"),v=r("el-dialog");return D(),O("div",_e,[l(v,{title:f.account==null?"":"\u5206\u914D\u201C"+f.account.username+"\u201D\u7684\u89D2\u8272",modelValue:e(p),"onUpdate:modelValue":d[4]||(d[4]=F=>K(p)?p.value=F:null),"before-close":A,"show-close":!1},{footer:u(()=>[T("div",ye,[l(t,{onClick:d[3]||(d[3]=F=>A())},{default:u(()=>[c("\u53D6 \u6D88")]),_:1}),l(t,{type:"primary",loading:e(C),onClick:U},{default:u(()=>[c("\u786E \u5B9A")]),_:1},8,["loading"])])]),default:u(()=>[T("div",ve,[T("div",De,[l(n,{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D",style:{width:"150px"},modelValue:e(m).name,"onUpdate:modelValue":d[0]||(d[0]=F=>e(m).name=F),onClear:d[1]||(d[1]=F=>N()),clearable:""},null,8,["modelValue"]),l(t,{onClick:q,type:"success",icon:"search"})])]),l(j,{data:e(k),border:"",ref_key:"roleTable",ref:y,onSelect:b,style:{width:"100%"}},{default:u(()=>[l(_,{selectable:V,type:"selection",width:"40"}),l(_,{prop:"name",label:"\u89D2\u8272\u540D\u79F0"}),l(_,{prop:"code",label:"\u89D2\u8272code"}),l(_,{prop:"remark",label:"\u89D2\u8272\u63CF\u8FF0"},{default:u(F=>[c(M(F.row.remark?F.row.remark:"\u6682\u65E0\u63CF\u8FF0"),1)]),_:1})]),_:1},8,["data"]),l(P,{onCurrentChange:w,style:{"text-align":"center","margin-top":"20px"},background:"",layout:"prev, pager, next, total, jumper",total:e(E),"current-page":e(m).pageNum,"onUpdate:current-page":d[2]||(d[2]=F=>e(m).pageNum=F),"page-size":e(m).pageSize},null,8,["total","current-page","page-size"])]),_:1},8,["title","modelValue"])])}}}),Fe={class:"account-dialog"},he={class:"dialog-footer"},Ce=W({__name:"AccountEdit",props:{visible:{type:Boolean},account:{type:[Boolean,Object]},title:{type:String}},emits:["update:visible","cancel","val-change"],setup(f,{emit:a}){const i=f,y=ae(null),g={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u59D3\u540D",trigger:["change","blur"]}],username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:["change","blur"]}]},p=H({dialogVisible:!1,edit:!1,form:{id:null,name:null,username:null,password:null,repassword:null},btnLoading:!1}),{dialogVisible:C,edit:k,form:m,btnLoading:E}=J(p);ue(i,V=>{V.account?(p.form=te({},V.account),p.edit=!0):(p.edit=!1,p.form={}),p.dialogVisible=V.visible});const h=async()=>{y.value.validate(V=>{if(V)$.save.request(p.form).then(()=>{L.success("\u64CD\u4F5C\u6210\u529F"),a("val-change",p.form),p.btnLoading=!0,setTimeout(()=>{p.btnLoading=!1},1e3),y.value.resetFields(),p.form={}});else return L.error("\u8868\u5355\u586B\u5199\u6709\u8BEF"),!1})},w=()=>{a("update:visible",!1),a("cancel")};return(V,b)=>{const R=r("el-input"),U=r("el-form-item"),A=r("el-form"),N=r("el-button"),q=r("el-dialog");return D(),O("div",Fe,[l(q,{title:f.title,modelValue:e(C),"onUpdate:modelValue":b[4]||(b[4]=s=>K(C)?C.value=s:null),"before-close":w,"show-close":!1,width:"35%","destroy-on-close":!0},{footer:u(()=>[T("div",he,[l(N,{onClick:b[3]||(b[3]=s=>w())},{default:u(()=>[c("\u53D6 \u6D88")]),_:1}),l(N,{type:"primary",loading:e(E),onClick:h},{default:u(()=>[c("\u786E \u5B9A")]),_:1},8,["loading"])])]),default:u(()=>[l(A,{model:e(m),ref_key:"accountForm",ref:y,rules:g,"label-width":"85px"},{default:u(()=>[l(U,{prop:"name",label:"\u59D3\u540D:",required:""},{default:u(()=>[l(R,{modelValue:e(m).name,"onUpdate:modelValue":b[0]||(b[0]=s=>e(m).name=s),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D","auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(U,{prop:"username",label:"\u7528\u6237\u540D:",required:""},{default:u(()=>[l(R,{disabled:e(k),modelValue:e(m).username,"onUpdate:modelValue":b[1]||(b[1]=s=>e(m).username=s),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7\u7528\u6237\u540D\uFF0C\u5BC6\u7801\u9ED8\u8BA4\u4E0E\u8D26\u53F7\u540D\u4E00\u81F4","auto-complete":"off"},null,8,["disabled","modelValue"])]),_:1}),e(k)?(D(),B(U,{key:0,prop:"password",label:"\u5BC6\u7801:"},{default:u(()=>[l(R,{type:"password",modelValue:e(m).password,"onUpdate:modelValue":b[2]||(b[2]=s=>e(m).password=s),modelModifiers:{trim:!0},placeholder:"\u8F93\u5165\u5BC6\u7801\u53EF\u4FEE\u6539\u7528\u6237\u5BC6\u7801",autocomplete:"new-password"},null,8,["modelValue"])]),_:1})):S("",!0)]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}}),ke={class:"role-list"},Ve={style:{float:"right"}},Be=T("i",null,null,-1),Ee={class:"custom-tree-node"},Re={key:0},qe={key:1,style:{color:"#67c23a"}},xe=W({__name:"AccountList",setup(f){const a=H({chooseId:null,chooseData:null,query:{username:"",pageNum:1,pageSize:10},datas:[],total:0,showRoleDialog:{title:"",visible:!1,accountRoles:[]},showResourceDialog:{title:"",visible:!1,resources:[],defaultProps:{children:"children",label:"name"}},roleDialog:{visible:!1,account:null,roles:[]},accountDialog:{visible:!1,data:null}}),{chooseId:i,query:y,datas:g,total:p,showRoleDialog:C,showResourceDialog:k,roleDialog:m,accountDialog:E}=J(a);me(()=>{w()});const h=n=>{!n||(a.chooseId=n.id,a.chooseData=n)},w=async()=>{let n=await $.list.request(a.query);a.datas=n.list,a.total=n.total},V=async n=>{let t=a.showResourceDialog;t.title='"'+n.username+'" \u7684\u83DC\u5355&\u6743\u9650',t.resources=[],t.resources=await $.resources.request({id:n.id}),t.visible=!0},b=async n=>{let t=a.showRoleDialog;t.title='"'+n.username+'" \u7684\u89D2\u8272\u4FE1\u606F',t.accountRoles=await $.roles.request({id:n.id}),t.visible=!0},R=async n=>{let t=n.id,_=n.status==-1?1:-1;await $.changeStatus.request({id:t,status:_}),L.success("\u64CD\u4F5C\u6210\u529F"),w()},U=n=>{a.query.pageNum=n,w()},A=()=>{a.chooseId||L.error("\u8BF7\u9009\u62E9\u8D26\u53F7"),a.roleDialog.visible=!0,a.roleDialog.account=a.chooseData},N=(n=!1)=>{n?a.accountDialog.data=null:a.accountDialog.data=a.chooseData,a.accountDialog.visible=!0},q=()=>{a.roleDialog.visible=!1,a.roleDialog.account=null,w()},s=()=>{a.accountDialog.visible=!1,w()},d=async()=>{try{await ge.confirm("\u786E\u5B9A\u5220\u9664\u8BE5\u8D26\u53F7?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await $.del.request({id:a.chooseId}),L.success("\u5220\u9664\u6210\u529F"),a.chooseData=null,a.chooseId=null,w()}catch{}};return(n,t)=>{const _=r("el-button"),j=r("el-input"),P=r("el-radio"),v=r("el-table-column"),F=r("el-tag"),Q=r("el-link"),X=r("el-table"),ne=r("el-pagination"),se=r("el-row"),ie=r("el-card"),Y=r("el-dialog"),re=r("el-tree"),z=fe("auth");return D(),O("div",ke,[l(ie,null,{default:u(()=>[I((D(),B(_,{type:"primary",icon:"plus",onClick:t[0]||(t[0]=o=>N(!0))},{default:u(()=>[c("\u6DFB\u52A0")]),_:1})),[[z,"account:add"]]),I((D(),B(_,{disabled:e(i)==null,onClick:t[1]||(t[1]=o=>N(!1)),type:"primary",icon:"edit"},{default:u(()=>[c("\u7F16\u8F91")]),_:1},8,["disabled"])),[[z,"account:add"]]),I((D(),B(_,{disabled:e(i)==null,onClick:t[2]||(t[2]=o=>A()),type:"success",icon:"setting"},{default:u(()=>[c("\u89D2\u8272\u5206\u914D")]),_:1},8,["disabled"])),[[z,"account:saveRoles"]]),I((D(),B(_,{disabled:e(i)==null,onClick:t[3]||(t[3]=o=>d()),type:"danger",icon:"delete"},{default:u(()=>[c("\u5220\u9664")]),_:1},8,["disabled"])),[[z,"account:del"]]),T("div",Ve,[l(j,{class:"mr2",placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7\u540D",size:"small",style:{width:"300px"},modelValue:e(y).username,"onUpdate:modelValue":t[4]||(t[4]=o=>e(y).username=o),onClear:t[5]||(t[5]=o=>w()),clearable:""},null,8,["modelValue"]),l(_,{onClick:t[6]||(t[6]=o=>w()),type:"success",icon:"search",size:"small"})]),l(X,{data:e(g),ref:"table",onCurrentChange:h,"show-overflow-tooltip":""},{default:u(()=>[l(v,{label:"\u9009\u62E9",width:"55px"},{default:u(o=>[l(P,{modelValue:e(i),"onUpdate:modelValue":t[7]||(t[7]=x=>K(i)?i.value=x:null),label:o.row.id},{default:u(()=>[Be]),_:2},1032,["modelValue","label"])]),_:1}),l(v,{prop:"name",label:"\u59D3\u540D","min-width":"115"}),l(v,{prop:"username",label:"\u7528\u6237\u540D","min-width":"115"}),l(v,{align:"center",prop:"status",label:"\u72B6\u6001","min-width":"70"},{default:u(o=>[o.row.status==1?(D(),B(F,{key:0,type:"success"},{default:u(()=>[c("\u6B63\u5E38")]),_:1})):S("",!0),o.row.status==-1?(D(),B(F,{key:1,type:"danger"},{default:u(()=>[c("\u7981\u7528")]),_:1})):S("",!0)]),_:1}),l(v,{"min-width":"160",prop:"lastLoginTime",label:"\u6700\u540E\u767B\u5F55\u65F6\u95F4","show-overflow-tooltip":""},{default:u(o=>[c(M(e(G)(o.row.lastLoginTime)),1)]),_:1}),l(v,{"min-width":"115",prop:"creator",label:"\u521B\u5EFA\u8D26\u53F7"}),l(v,{"min-width":"160",prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","show-overflow-tooltip":""},{default:u(o=>[c(M(e(G)(o.row.createTime)),1)]),_:1}),l(v,{label:"\u67E5\u770B\u66F4\u591A","min-width":"150"},{default:u(o=>[l(Q,{onClick:le(x=>b(o.row),["prevent"]),type:"success"},{default:u(()=>[c("\u89D2\u8272")]),_:2},1032,["onClick"]),l(Q,{class:"ml5",onClick:le(x=>V(o.row),["prevent"]),type:"info"},{default:u(()=>[c("\u83DC\u5355&\u6743\u9650")]),_:2},1032,["onClick"])]),_:1}),l(v,{label:"\u64CD\u4F5C","min-width":"200px"},{default:u(o=>[o.row.status==1?I((D(),B(_,{key:0,onClick:x=>R(o.row),type:"danger",icom:"tickets",size:"small",plain:""},{default:u(()=>[c("\u7981\u7528")]),_:2},1032,["onClick"])),[[z,"account:changeStatus"]]):S("",!0),o.row.status==-1?I((D(),B(_,{key:1,type:"success",onClick:x=>R(o.row),size:"small",plain:""},{default:u(()=>[c("\u542F\u7528")]),_:2},1032,["onClick"])),[[z,"account:changeStatus"]]):S("",!0)]),_:1})]),_:1},8,["data"]),l(se,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:u(()=>[l(ne,{style:{"text-align":"right"},onCurrentChange:U,total:e(p),layout:"prev, pager, next, total, jumper","current-page":e(y).pageNum,"onUpdate:current-page":t[8]||(t[8]=o=>e(y).pageNum=o),"page-size":e(y).pageSize},null,8,["total","current-page","page-size"])]),_:1})]),_:1}),l(Y,{width:"500px",title:e(C).title,modelValue:e(C).visible,"onUpdate:modelValue":t[9]||(t[9]=o=>e(C).visible=o)},{default:u(()=>[l(X,{border:"",data:e(C).accountRoles},{default:u(()=>[l(v,{property:"name",label:"\u89D2\u8272\u540D",width:"125"}),l(v,{property:"creator",label:"\u5206\u914D\u8D26\u53F7",width:"125"}),l(v,{property:"createTime",label:"\u5206\u914D\u65F6\u95F4"},{default:u(o=>[c(M(e(G)(o.row.createTime)),1)]),_:1})]),_:1},8,["data"])]),_:1},8,["title","modelValue"]),l(Y,{title:e(k).title,modelValue:e(k).visible,"onUpdate:modelValue":t[10]||(t[10]=o=>e(k).visible=o),width:"400px"},{default:u(()=>[l(re,{style:{height:"50vh",overflow:"auto"},data:e(k).resources,"node-key":"id",props:e(k).defaultProps,"expand-on-click-node":!0},{default:u(({node:o,data:x})=>[T("span",Ee,[x.type==e(oe).ResourceTypeEnum.MENU.value?(D(),O("span",Re,M(o.label),1)):S("",!0),x.type==e(oe).ResourceTypeEnum.PERMISSION.value?(D(),O("span",qe,M(o.label),1)):S("",!0)])]),_:1},8,["data","props"])]),_:1},8,["title","modelValue"]),l(we,{visible:e(m).visible,"onUpdate:visible":t[11]||(t[11]=o=>e(m).visible=o),account:e(m).account,onCancel:t[12]||(t[12]=o=>q())},null,8,["visible","account"]),l(Ce,{visible:e(E).visible,"onUpdate:visible":t[13]||(t[13]=o=>e(E).visible=o),account:e(E).data,"onUpdate:account":t[14]||(t[14]=o=>e(E).data=o),onValChange:t[15]||(t[15]=o=>s())},null,8,["visible","account"])])}}});var ze=xe;export{ze as default};
