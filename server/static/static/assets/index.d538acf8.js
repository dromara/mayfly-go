var ne=Object.defineProperty;var U=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var T=(a,r,s)=>r in a?ne(a,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[r]=s,B=(a,r)=>{for(var s in r||(r={}))ae.call(r,s)&&T(a,s,r[s]);if(U)for(var s of U(r))se.call(r,s)&&T(a,s,r[s]);return a};import{o as x,_ as $,d as K,u as N,a as le,b as ie,r as R,c as M,t as W,e as re,n as ue,f as Z,g as ce,h as f,i as V,j,k as t,w as l,l as o,m as de,p as ge,q as p,s as pe,v as S,x as G,y as H,z as q,A as me,B as fe,C as L,E as z,D as we,F as he,G as _e,H as ye,T as ve,I as be,J as xe}from"./index.db2b5b0c.js";import{R as P}from"./rsa.e4863f18.js";import"./assert.d82c837d.js";const Fe="UseLoginCaptcha",Ce="UseWartermark";async function Be(a){return await x.getConfigValue({key:a})}async function J(a,r){const s=await Be(a);return s?s=="1":r}async function Pe(){return await J(Fe,!0)}async function Ve(){return await J(Ce,!0)}const De=a=>(G("data-v-05608980"),a=a(),H(),a),ke={class:"login-content-code"},Ee=["src"],Ie=De(()=>p("span",null,"\u767B \u5F55",-1)),Ae={class:"dialog-footer"},Ue=K({__name:"AccountLogin",setup(a){const r={username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"}],captcha:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"}]},s=N(),_=le(),w=ie(),y=R(null),v=R(null),e=M({isUseLoginCaptcha:!1,captchaImage:"",loginForm:{username:"",password:"",captcha:"",cid:""},changePwdDialog:{visible:!1,form:{username:"",oldPassword:"",newPassword:""},rules:{newPassword:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801",trigger:"blur"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)(?=.*[`~!@#$%^&*()_+<>?:"{},.\/\\;'[\]])[A-Za-z\d`~!@#$%^&*()_+<>?:"{},.\/\\;'[\]]{8,}$/,message:"\u987B\u4E3A8\u4F4D\u4EE5\u4E0A\u4E14\u5305\u542B\u5B57\u2E9F\u2F24\u2F29\u5199+\u6570\u5B57+\u7279\u6B8A\u7B26\u53F7",trigger:"blur"}]}},loading:{signIn:!1,changePwd:!1}}),{isUseLoginCaptcha:b,captchaImage:F,loginForm:m,changePwdDialog:g,loading:D}=W(e);re(async()=>{ue(async()=>{e.isUseLoginCaptcha=await Pe(),h()}),sessionStorage.removeItem("RsaPublicKey")});const h=async()=>{if(!e.isUseLoginCaptcha)return;let i=await x.captcha();e.captchaImage=i.base64Captcha,e.loginForm.cid=i.cid},Q=Z(()=>ce(new Date)),k=()=>{y.value.validate(i=>{if(i)X();else return!1})},X=async()=>{e.loading.signIn=!0;let i;const n=e.loginForm.password;try{const c=B({},e.loginForm);c.password=await P(n),i=await x.login(c),q("token",i.token),q("menus",i.menus)}catch(c){e.loading.signIn=!1,e.loginForm.captcha="",c.code&&c.code==401?(e.changePwdDialog.form.username=e.loginForm.username,e.changePwdDialog.form.oldPassword=n,e.changePwdDialog.form.newPassword="",e.changePwdDialog.visible=!0):h();return}const u={name:i.name,username:e.loginForm.username,photo:me(e.loginForm.username),time:new Date().getTime(),permissions:i.permissions,lastLoginTime:i.lastLoginTime,lastLoginIp:i.lastLoginIp};fe(u),s.dispatch("userInfos/setUserInfos",u),s.state.themeConfig.themeConfig.isRequestRoutes?(await L(),E()):(await L(),E())},E=()=>{var n;let i=Q.value;(n=_.query)!=null&&n.redirect?w.push(_.query.redirect):w.push("/"),setTimeout(async()=>{e.loading.signIn=!0,z.success(`${i}\uFF0C\u6B22\u8FCE\u56DE\u6765\uFF01`),await Ve()&&we(!0)},300)},Y=()=>{v.value.validate(async i=>{if(!i)return!1;try{e.loading.changePwd=!0;const n=e.changePwdDialog.form,u=B({},n);u.oldPassword=await P(n.oldPassword),u.newPassword=await P(n.newPassword),await x.changePwd(u),z.success("\u5BC6\u7801\u4FEE\u6539\u6210\u529F, \u65B0\u5BC6\u7801\u5DF2\u586B\u5145\u81F3\u767B\u5F55\u5BC6\u7801\u6846"),e.loginForm.password=e.changePwdDialog.form.newPassword,e.changePwdDialog.visible=!1,h()}finally{e.loading.changePwd=!1}})},ee=()=>{e.changePwdDialog.visible=!1,e.changePwdDialog.form.newPassword="",e.changePwdDialog.form.oldPassword="",e.changePwdDialog.form.username="",h()};return(i,n)=>{const u=f("el-input"),c=f("el-form-item"),I=f("el-col"),oe=f("el-row"),C=f("el-button"),A=f("el-form"),te=f("el-dialog");return V(),j("div",null,[t(A,{ref_key:"loginFormRef",ref:y,model:o(m),rules:r,class:"login-content-form",size:"large"},{default:l(()=>[t(c,{prop:"username"},{default:l(()=>[t(u,{type:"text",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D","prefix-icon":"user",modelValue:o(m).username,"onUpdate:modelValue":n[0]||(n[0]=d=>o(m).username=d),clearable:"",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(c,{prop:"password"},{default:l(()=>[t(u,{type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801","prefix-icon":"lock",modelValue:o(m).password,"onUpdate:modelValue":n[1]||(n[1]=d=>o(m).password=d),autocomplete:"off","show-password":""},null,8,["modelValue"])]),_:1}),o(b)?(V(),de(c,{key:0,prop:"captcha"},{default:l(()=>[t(oe,{gutter:15},{default:l(()=>[t(I,{span:16},{default:l(()=>[t(u,{type:"text",maxlength:"6",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801","prefix-icon":"position",modelValue:o(m).captcha,"onUpdate:modelValue":n[2]||(n[2]=d=>o(m).captcha=d),clearable:"",autocomplete:"off",onKeyup:ge(k,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(I,{span:8},{default:l(()=>[p("div",ke,[p("img",{class:"login-content-code-img",onClick:h,width:"130px",height:"40px",src:o(F),style:{cursor:"pointer"}},null,8,Ee)])]),_:1})]),_:1})]),_:1})):pe("",!0),t(c,null,{default:l(()=>[t(C,{type:"primary",class:"login-content-submit",round:"",onClick:k,loading:o(D).signIn},{default:l(()=>[Ie]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),t(te,{title:"\u4FEE\u6539\u5BC6\u7801",modelValue:o(g).visible,"onUpdate:modelValue":n[6]||(n[6]=d=>o(g).visible=d),"close-on-click-modal":!1,width:"450px","destroy-on-close":!0},{footer:l(()=>[p("div",Ae,[t(C,{onClick:ee},{default:l(()=>[S("\u53D6 \u6D88")]),_:1}),t(C,{onClick:Y,type:"primary",loading:o(D).changePwd},{default:l(()=>[S("\u786E \u5B9A")]),_:1},8,["loading"])])]),default:l(()=>[t(A,{model:o(g).form,rules:o(g).rules,ref_key:"changePwdFormRef",ref:v,"label-width":"65px"},{default:l(()=>[t(c,{prop:"username",label:"\u7528\u6237\u540D",required:""},{default:l(()=>[t(u,{modelValue:o(g).form.username,"onUpdate:modelValue":n[3]||(n[3]=d=>o(g).form.username=d),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])]),_:1}),t(c,{prop:"oldPassword",label:"\u65E7\u5BC6\u7801",required:""},{default:l(()=>[t(u,{modelValue:o(g).form.oldPassword,"onUpdate:modelValue":n[4]||(n[4]=d=>o(g).form.oldPassword=d),modelModifiers:{trim:!0},autocomplete:"new-password",type:"password"},null,8,["modelValue"])]),_:1}),t(c,{prop:"newPassword",label:"\u65B0\u5BC6\u7801",required:""},{default:l(()=>[t(u,{modelValue:o(g).form.newPassword,"onUpdate:modelValue":n[5]||(n[5]=d=>o(g).form.newPassword=d),modelModifiers:{trim:!0},placeholder:"\u987B\u4E3A8\u4F4D\u4EE5\u4E0A\u4E14\u5305\u542B\u5B57\u2E9F\u2F24\u2F29\u5199+\u6570\u5B57+\u7279\u6B8A\u7B26\u53F7",type:"password",autocomplete:"new-password"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});var Te=$(Ue,[["__scopeId","data-v-05608980"]]);const O=a=>(G("data-v-95005104"),a=a(),H(),a),Re={class:"login-container"},Se={class:"login-logo"},qe={class:"login-content-main"},Le=O(()=>p("h4",{class:"login-content-title"},"mayfly-go",-1)),ze=O(()=>p("div",{class:"login-copyright"},[p("div",{class:"mb5 login-copyright-company"},"mayfly"),p("div",{class:"login-copyright-msg"},"mayfly")],-1)),$e=K({__name:"index",setup(a){const r=N(),s=M({tabsActiveName:"account",isTabPaneShow:!0}),{isTabPaneShow:_,tabsActiveName:w}=W(s),y=Z(()=>r.state.themeConfig.themeConfig),v=()=>{s.isTabPaneShow=!s.isTabPaneShow};return(e,b)=>{const F=f("el-tab-pane"),m=f("el-tabs");return V(),j("div",Re,[p("div",Se,[p("span",null,he(o(y).globalViceTitle),1)]),p("div",{class:ye(["login-content",{"login-content-mobile":o(w)==="mobile"}])},[p("div",qe,[Le,t(m,{modelValue:o(w),"onUpdate:modelValue":b[0]||(b[0]=g=>_e(w)?w.value=g:null),onTabClick:v},{default:l(()=>[t(F,{label:"\u8D26\u53F7\u5BC6\u7801\u767B\u5F55",name:"account",disabled:o(w)==="account"},{default:l(()=>[t(ve,{name:"el-zoom-in-center"},{default:l(()=>[be(t(Te,null,null,512),[[xe,o(_)]])]),_:1})]),_:1},8,["disabled"])]),_:1},8,["modelValue"])])],2),ze])}}});var Ze=$($e,[["__scopeId","data-v-95005104"]]);export{Ze as default};
