var re=Object.defineProperty;var J=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var Q=(c,l,a)=>l in c?re(c,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[l]=a,X=(c,l)=>{for(var a in l||(l={}))ie.call(l,a)&&Q(c,a,l[a]);if(J)for(var a of J(l))de.call(l,a)&&Q(c,a,l[a]);return c};import{d as K,r as Z,c as L,t as O,L as H,h as d,i as v,j as R,k as o,w as s,q as I,v as k,l as e,G as j,F as $,s as N,E as z,a1 as ee,W as le,a2 as ce,e as pe,V as me,I as q,m as M,U as Y}from"./index.3ab9ca99.js";import{a as B,r as fe}from"./api.6c08f270.js";import{e as S}from"./enums.eff18c1f.js";import"./Api.7cd1a1f8.js";import"./Enum.48e42737.js";const ge={class:"role-dialog"},be={class:"dialog-footer"},_e=K({__name:"RoleEdit",props:{visible:{type:Boolean},data:{type:[Boolean,Object]},title:{type:String}},emits:["update:visible","cancel","val-change"],setup(c,{emit:l}){const a=c,x=Z(null),g=L({dvisible:!1,form:{id:null,name:"",code:"",status:1,remark:""},btnLoading:!1}),{dvisible:m,form:i,btnLoading:D}=O(g);H(a,r=>{g.dvisible=r.visible,r.data?g.form=X({},r.data):g.form={}});const b=()=>{l("update:visible",!1),l("cancel")},f=async()=>{x.value.validate(async r=>{r&&(await B.save.request(g.form),l("val-change",g.form),b(),g.btnLoading=!0,setTimeout(()=>{g.btnLoading=!1},1e3))})};return(r,p)=>{const h=d("el-input"),E=d("el-form-item"),F=d("el-form"),C=d("el-button"),w=d("el-dialog");return v(),R("div",ge,[o(w,{title:c.title,modelValue:e(m),"onUpdate:modelValue":p[4]||(p[4]=_=>j(m)?m.value=_:null),"show-close":!1,"before-close":b,width:"500px","destroy-on-close":!0},{footer:s(()=>[I("div",be,[o(C,{onClick:p[3]||(p[3]=_=>b())},{default:s(()=>[k("\u53D6 \u6D88")]),_:1}),o(C,{type:"primary",loading:e(D),onClick:f},{default:s(()=>[k("\u786E \u5B9A")]),_:1},8,["loading"])])]),default:s(()=>[o(F,{ref_key:"roleForm",ref:x,model:e(i),"label-width":"90px"},{default:s(()=>[o(E,{prop:"name",label:"\u89D2\u8272\u540D\u79F0:",required:""},{default:s(()=>[o(h,{modelValue:e(i).name,"onUpdate:modelValue":p[0]||(p[0]=_=>e(i).name=_),"auto-complete":"off"},null,8,["modelValue"])]),_:1}),o(E,{prop:"code",label:"\u89D2\u8272code:",required:""},{default:s(()=>[o(h,{disabled:e(i).id!=null,modelValue:e(i).code,"onUpdate:modelValue":p[1]||(p[1]=_=>e(i).code=_),placeholder:"COMMON\u5F00\u5934\u5219\u4E3A\u6240\u6709\u8D26\u53F7\u5171\u6709\u89D2\u8272","auto-complete":"off"},null,8,["disabled","modelValue"])]),_:1}),o(E,{label:"\u89D2\u8272\u63CF\u8FF0:"},{default:s(()=>[o(h,{modelValue:e(i).remark,"onUpdate:modelValue":p[2]||(p[2]=_=>e(i).remark=_),type:"textarea",rows:3,placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u63CF\u8FF0"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}}),ye={class:"custom-tree-node"},ve={key:0},De={key:1,style:{color:"#67c23a"}},he={class:"dialog-footer"},Fe=K({__name:"ResourceEdit",props:{visible:{type:Boolean},title:{type:String},role:{type:Object},defaultCheckedKeys:{type:Array},resources:{type:Array}},emits:["update:visible","cancel","val-change"],setup(c,{emit:l}){const a=c,x={children:"children",label:"name"},g=Z(null),m=L({dialogVisible:!1,roleInfo:null}),{dialogVisible:i,roleInfo:D}=O(m);H(()=>a.visible,r=>{m.dialogVisible=r,m.roleInfo=a.role});const b=async()=>{let r=g.value.getCheckedKeys(),p=g.value.getHalfCheckedKeys(),h=[].concat(r,p).join(",");await B.saveResources.request({id:a.role.id,resourceIds:h}),z.success("\u4FDD\u5B58\u6210\u529F!"),l("cancel")},f=()=>{l("update:visible",!1),l("cancel")};return(r,p)=>{var C;const h=d("el-tree"),E=d("el-button"),F=d("el-dialog");return v(),R("div",null,[o(F,{title:"\u5206\u914D\u201C"+((C=e(D))==null?void 0:C.name)+"\u201D\u83DC\u5355&\u6743\u9650",modelValue:e(i),"onUpdate:modelValue":p[0]||(p[0]=w=>j(i)?i.value=w:null),"before-close":f,"show-close":!1,width:"400px"},{footer:s(()=>[I("div",he,[o(E,{onClick:f},{default:s(()=>[k("\u53D6 \u6D88")]),_:1}),o(E,{type:"primary",onClick:b},{default:s(()=>[k("\u786E \u5B9A")]),_:1})])]),default:s(()=>[o(h,{style:{height:"50vh",overflow:"auto"},ref_key:"menuTree",ref:g,data:c.resources,"show-checkbox":"","node-key":"id","default-checked-keys":c.defaultCheckedKeys,props:x},{default:s(({node:w,data:_})=>[I("span",ye,[_.type==e(S).ResourceTypeEnum.MENU.value?(v(),R("span",ve,$(w.label),1)):N("",!0),_.type==e(S).ResourceTypeEnum.PERMISSION.value?(v(),R("span",De,$(w.label),1)):N("",!0)])]),_:1},8,["data","default-checked-keys"])]),_:1},8,["title","modelValue"])])}}}),Ce={class:"custom-tree-node"},ke={key:0},Ee={key:1,style:{color:"#67c23a"}},we=K({__name:"ShowResource",props:{visible:{type:Boolean},resources:{type:Array},title:{type:String}},emits:["update:visible","update:resources"],setup(c,{emit:l}){const a=c,{proxy:x}=ce(),g={children:"children",label:"name"},m=L({dialogVisible:!1}),{dialogVisible:i}=O(m);H(()=>a.visible,f=>{m.dialogVisible=f});const D=f=>{le.alert('<strong style="margin-right: 18px">\u8D44\u6E90\u540D\u79F0:</strong>'+f.name+' <br/><strong style="margin-right: 18px">\u5206\u914D\u8D26\u53F7:</strong>'+f.creator+' <br/><strong style="margin-right: 18px">\u5206\u914D\u65F6\u95F4:</strong>'+x.$filters.dateFormat(f.createTime),"\u5206\u914D\u4FE1\u606F",{type:"info",dangerouslyUseHTMLString:!0,closeOnClickModal:!0,showConfirmButton:!1}).catch(()=>{})},b=()=>{l("update:visible",!1),l("update:resources",[])};return(f,r)=>{const p=d("el-link"),h=d("el-tree"),E=d("el-dialog");return v(),R("div",null,[o(E,{onClose:b,title:c.title,"before-close":b,modelValue:e(i),"onUpdate:modelValue":r[0]||(r[0]=F=>j(i)?i.value=F:null),width:"400px"},{default:s(()=>[o(h,{style:{height:"50vh",overflow:"auto"},data:c.resources,"node-key":"id",props:g},{default:s(({node:F,data:C})=>[I("span",Ce,[C.type==e(S).ResourceTypeEnum.MENU.value?(v(),R("span",ke,$(F.label),1)):N("",!0),C.type==e(S).ResourceTypeEnum.PERMISSION.value?(v(),R("span",Ee,$(F.label),1)):N("",!0),o(p,{onClick:ee(w=>D(C),["prevent"]),style:{"margin-left":"25px"},icon:"InfoFilled",type:"info",underline:!1},null,8,["onClick"])])]),_:1},8,["data"])]),_:1},8,["title","modelValue"])])}}}),Ve={class:"role-list"},xe={style:{float:"right"}},Re=I("i",null,null,-1),Be=K({__name:"RoleList",setup(c){const l=L({query:{pageNum:1,pageSize:10,name:null},total:0,roles:[],chooseId:null,chooseData:null,resourceDialog:{visible:!1,role:{},resources:[],defaultCheckedKeys:[]},roleEditDialog:{title:"\u89D2\u8272\u7F16\u8F91",visible:!1,role:{}},showResourceDialog:{visible:!1,resources:[],title:""}}),{query:a,total:x,roles:g,chooseId:m,chooseData:i,resourceDialog:D,roleEditDialog:b,showResourceDialog:f}=O(l);pe(()=>{r()});const r=async()=>{let u=await B.list.request(l.query);l.roles=u.list,l.total=u.total},p=u=>{l.query.pageNum=u,r()},h=u=>{!u||(l.chooseId=u.id,l.chooseData=u)},E=()=>{z.success("\u4FEE\u6539\u6210\u529F\uFF01"),l.chooseId=null,l.chooseData=null,r()},F=u=>{u?l.roleEditDialog.role=u:l.roleEditDialog.role=!1,l.roleEditDialog.visible=!0},C=async u=>{try{await le.confirm(`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664 [${u.name}] \u8BE5\u89D2\u8272\uFF0C\u4EE5\u53CA\u4E0E\u8BE5\u89D2\u8272\u6709\u5173\u7684\u8D26\u53F7\u89D2\u8272\u5173\u8054\u4FE1\u606F\u548C\u8D44\u6E90\u89D2\u8272\u5173\u8054\u4FE1\u606F, \u662F\u5426\u7EE7\u7EED?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await B.del.request({id:u.id}),z.success("\u5220\u9664\u6210\u529F\uFF01"),r()}catch{}},w=async u=>{l.showResourceDialog.resources=await B.roleResources.request({id:u.id}),l.showResourceDialog.title='"'+u.name+'"\u7684\u83DC\u5355&\u6743\u9650',l.showResourceDialog.visible=!0},_=async u=>{let t=await fe.list.request(null);l.resourceDialog.resources=t;let y=await B.roleResourceIds.request({id:u.id}),P=y||[],T=[],V=oe(l.resourceDialog.resources);for(let U of V)P.includes(U)&&T.push(U);l.resourceDialog.defaultCheckedKeys=T,l.resourceDialog.visible=!0,l.resourceDialog.role=u},oe=u=>{let t=[];for(let y of u)G(y,t);return t},G=(u,t)=>{if(u.children!==null)for(let y of u.children)G(y,t);else t.push(u.id)},te=()=>{l.resourceDialog.visible=!1,setTimeout(()=>{l.resourceDialog.role={},l.resourceDialog.defaultCheckedKeys=[]},10)};return(u,t)=>{const y=d("el-button"),P=d("el-input"),T=d("el-radio"),V=d("el-table-column"),U=d("el-link"),se=d("el-table"),ue=d("el-pagination"),ae=d("el-row"),ne=d("el-card"),A=me("auth");return v(),R("div",Ve,[o(ne,null,{default:s(()=>[q((v(),M(y,{type:"primary",icon:"plus",onClick:t[0]||(t[0]=n=>F(!1))},{default:s(()=>[k("\u6DFB\u52A0")]),_:1})),[[A,"role:add"]]),q((v(),M(y,{disabled:e(m)==null,onClick:t[1]||(t[1]=n=>F(e(i))),type:"primary",icon:"edit"},{default:s(()=>[k("\u7F16\u8F91")]),_:1},8,["disabled"])),[[A,"role:update"]]),q((v(),M(y,{disabled:e(m)==null,onClick:t[2]||(t[2]=n=>_(e(i))),type:"success",icon:"setting"},{default:s(()=>[k("\u5206\u914D\u83DC\u5355&\u6743\u9650")]),_:1},8,["disabled"])),[[A,"role:saveResources"]]),q((v(),M(y,{disabled:e(m)==null,onClick:t[3]||(t[3]=n=>C(e(i))),type:"danger",icon:"delete"},{default:s(()=>[k("\u5220\u9664")]),_:1},8,["disabled"])),[[A,"role:del"]]),I("div",xe,[o(P,{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",class:"mr2",style:{width:"200px"},modelValue:e(a).name,"onUpdate:modelValue":t[4]||(t[4]=n=>e(a).name=n),onClear:r,clearable:""},null,8,["modelValue"]),o(y,{onClick:r,type:"success",icon:"search"})]),o(se,{data:e(g),onCurrentChange:h,ref:"table",style:{width:"100%"}},{default:s(()=>[o(V,{label:"\u9009\u62E9",width:"55px"},{default:s(n=>[o(T,{modelValue:e(m),"onUpdate:modelValue":t[5]||(t[5]=W=>j(m)?m.value=W:null),label:n.row.id},{default:s(()=>[Re]),_:2},1032,["modelValue","label"])]),_:1}),o(V,{prop:"name",label:"\u89D2\u8272\u540D\u79F0"}),o(V,{prop:"code",label:"\u89D2\u8272code"}),o(V,{prop:"remark",label:"\u63CF\u8FF0","min-width":"160px","show-overflow-tooltip":""}),o(V,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:s(n=>[k($(e(Y)(n.row.createTime)),1)]),_:1}),o(V,{prop:"updateTime",label:"\u4FEE\u6539\u65F6\u95F4"},{default:s(n=>[k($(e(Y)(n.row.updateTime)),1)]),_:1}),o(V,{label:"\u67E5\u770B\u66F4\u591A","min-width":"80px"},{default:s(n=>[o(U,{onClick:ee(W=>w(n.row),["prevent"]),type:"info"},{default:s(()=>[k("\u83DC\u5355&\u6743\u9650")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),o(ae,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:s(()=>[o(ue,{style:{"text-align":"right"},onCurrentChange:p,total:e(x),layout:"prev, pager, next, total, jumper","current-page":e(a).pageNum,"onUpdate:current-page":t[6]||(t[6]=n=>e(a).pageNum=n),"page-size":e(a).pageSize},null,8,["total","current-page","page-size"])]),_:1})]),_:1}),o(_e,{title:e(b).title,visible:e(b).visible,"onUpdate:visible":t[7]||(t[7]=n=>e(b).visible=n),data:e(b).role,onValChange:E},null,8,["title","visible","data"]),o(Fe,{visible:e(D).visible,"onUpdate:visible":t[8]||(t[8]=n=>e(D).visible=n),role:e(D).role,resources:e(D).resources,defaultCheckedKeys:e(D).defaultCheckedKeys,onCancel:t[9]||(t[9]=n=>te())},null,8,["visible","role","resources","defaultCheckedKeys"]),o(we,{visible:e(f).visible,"onUpdate:visible":t[10]||(t[10]=n=>e(f).visible=n),title:e(f).title,resources:e(f).resources,"onUpdate:resources":t[11]||(t[11]=n=>e(f).resources=n)},null,8,["visible","title","resources"])])}}});var Me=Be;export{Me as default};
