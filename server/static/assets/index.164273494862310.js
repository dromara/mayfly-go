var z=Object.defineProperty,O=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var P=(e,o,d)=>o in e?z(e,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[o]=d,E=(e,o)=>{for(var d in o||(o={}))G.call(o,d)&&P(e,d,o[d]);if(S)for(var d of S(o))J.call(o,d)&&P(e,d,o[d]);return e},C=(e,o)=>O(e,K(o));import{_ as j}from"./index.1642734948623.js";import{y as $,a as V,F as R,t as k,d as _,q as f,e as g,j as t,k as l,f as s,i as u,I as B,J as D,r as H,E as I,G as q,h as b,o as Q,P as W}from"./vendor.1642734948623.js";import{r as w}from"./api.16427349486235.js";import{p as M}from"./api.16427349486233.js";import"./Api.1642734948623.js";const X=$({name:"Info",props:{visible:{type:Boolean},title:{type:String},info:{type:[Boolean,Object]}},setup(e,{emit:o}){const d=V({dialogVisible:!1});R(()=>e.visible,F=>{d.dialogVisible=F});const i=()=>{o("update:visible",!1),o("close")};return C(E({},k(d)),{close:i})}}),Y={class:"row"},Z=s("span",{class:"title"},"redis_version(\u7248\u672C):",-1),x={class:"value"},ee={class:"row"},se=s("span",{class:"title"},"tcp_port(\u7AEF\u53E3):",-1),oe={class:"value"},te={class:"row"},le=s("span",{class:"title"},"redis_mode(\u6A21\u5F0F):",-1),ue={class:"value"},ne={class:"row"},ae=s("span",{class:"title"},"os(\u5BBF\u4E3B\u64CD\u4F5C\u7CFB\u7EDF):",-1),ie={class:"value"},re={class:"row"},de=s("span",{class:"title"},"uptime_in_days(\u8FD0\u884C\u5929\u6570):",-1),ce={class:"value"},pe={class:"row"},_e=s("span",{class:"title"},"executable(\u53EF\u6267\u884C\u6587\u4EF6\u8DEF\u5F84):",-1),me={class:"value"},fe={class:"row"},ve=s("span",{class:"title"},"config_file(\u914D\u7F6E\u6587\u4EF6\u8DEF\u5F84):",-1),he={class:"value"},Fe={class:"row"},ge=s("span",{class:"title"},"connected_clients(\u5DF2\u8FDE\u63A5\u5BA2\u6237\u7AEF\u6570):",-1),be={class:"value"},Ee={class:"row"},ye=s("span",{class:"title"},"blocked_clients(\u6B63\u5728\u7B49\u5F85\u963B\u585E\u547D\u4EE4\u5BA2\u6237\u7AEF\u6570):",-1),Ce={class:"value"},Be={class:"title"},De={class:"value"},we={class:"row"},Ae=s("span",{class:"title"},"total_commands_processed(\u603B\u5904\u7406\u547D\u4EE4\u6570):",-1),je={class:"value"},$e={class:"row"},Ve=s("span",{class:"title"},"instantaneous_ops_per_sec(\u5F53\u524Dqps):",-1),ke={class:"value"},Ie={class:"row"},qe=s("span",{class:"title"},"total_net_input_bytes(\u7F51\u7EDC\u5165\u53E3\u6D41\u91CF\u5B57\u8282\u6570):",-1),Ue={class:"value"},Se={class:"row"},Pe=s("span",{class:"title"},"total_net_output_bytes(\u7F51\u7EDC\u51FA\u53E3\u6D41\u91CF\u5B57\u8282\u6570):",-1),Re={class:"value"},Me={class:"row"},Te=s("span",{class:"title"},"expired_keys(\u8FC7\u671Fkey\u7684\u603B\u6570\u91CF):",-1),Le={class:"value"},Ne={class:"row"},ze=s("span",{class:"title"},"instantaneous_ops_per_sec(\u5F53\u524Dqps):",-1),Oe={class:"value"},Ke={class:"row"},Ge=s("span",{class:"title"},"aof_enabled(\u662F\u5426\u542F\u7528aof):",-1),Je={class:"value"},He={class:"row"},Qe=s("span",{class:"title"},"loading(\u662F\u5426\u6B63\u5728\u8F7D\u5165\u6301\u4E45\u5316\u6587\u4EF6):",-1),We={class:"value"},Xe={class:"row"},Ye=s("span",{class:"title"},"cluster_enabled(\u662F\u5426\u542F\u7528\u96C6\u7FA4\u6A21\u5F0F):",-1),Ze={class:"value"},xe={class:"row"},es=s("span",{class:"title"},"used_memory(\u5206\u914D\u5185\u5B58\u603B\u91CF):",-1),ss={class:"value"},os={class:"row"},ts=s("span",{class:"title"},"maxmemory(\u6700\u5927\u5185\u5B58\u914D\u7F6E):",-1),ls={class:"value"},us={class:"row"},ns=s("span",{class:"title"},"used_memory_rss(\u5DF2\u5206\u914D\u7684\u5185\u5B58\u603B\u91CF\uFF0C\u64CD\u4F5C\u7CFB\u7EDF\u89D2\u5EA6):",-1),as={class:"value"},is={class:"row"},rs=s("span",{class:"title"},"mem_fragmentation_ratio(used_memory_rss\u548Cused_memory \u4E4B\u95F4\u7684\u6BD4\u7387):",-1),ds={class:"value"},cs={class:"row"},ps=s("span",{class:"title"},"used_memory_peak(\u5185\u5B58\u6D88\u8017\u5CF0\u503C):",-1),_s={class:"value"},ms={class:"row"},fs=s("span",{class:"title"},"total_system_memory(\u4E3B\u673A\u603B\u5185\u5B58):",-1),vs={class:"value"},hs={class:"row"},Fs=s("span",{class:"title"},"used_cpu_sys(\u7531Redis\u670D\u52A1\u5668\u6D88\u8017\u7684\u7CFB\u7EDFCPU):",-1),gs={class:"value"},bs={class:"row"},Es=s("span",{class:"title"},"used_cpu_user(\u7531Redis\u670D\u52A1\u5668\u6D88\u8017\u7684\u7528\u6237CPU):",-1),ys={class:"value"},Cs={class:"row"},Bs=s("span",{class:"title"},"used_cpu_sys_children(\u7531\u540E\u53F0\u8FDB\u7A0B\u6D88\u8017\u7684\u7CFB\u7EDFCPU):",-1),Ds={class:"value"},ws={class:"row"},As=s("span",{class:"title"},"used_cpu_user_children(\u7531\u540E\u53F0\u8FDB\u7A0B\u6D88\u8017\u7684\u7528\u6237CPU):",-1),js={class:"value"};function $s(e,o,d,i,F,v){const p=_("el-collapse-item"),h=_("el-collapse"),n=_("el-dialog");return f(),g("div",null,[t(n,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":o[0]||(o[0]=a=>e.dialogVisible=a),"show-close":!0,width:"35%",onClose:o[1]||(o[1]=a=>e.close())},{default:l(()=>[t(h,null,{default:l(()=>[t(p,{title:"Server(Redis\u670D\u52A1\u5668\u7684\u4E00\u822C\u4FE1\u606F)",name:"server"},{default:l(()=>[s("div",Y,[Z,s("span",x,u(e.info.Server.redis_version),1)]),s("div",ee,[se,s("span",oe,u(e.info.Server.tcp_port),1)]),s("div",te,[le,s("span",ue,u(e.info.Server.redis_mode),1)]),s("div",ne,[ae,s("span",ie,u(e.info.Server.os),1)]),s("div",re,[de,s("span",ce,u(e.info.Server.uptime_in_days),1)]),s("div",pe,[_e,s("span",me,u(e.info.Server.executable),1)]),s("div",fe,[ve,s("span",he,u(e.info.Server.config_file),1)])]),_:1}),t(p,{title:"Clients(\u5BA2\u6237\u7AEF\u8FDE\u63A5)",name:"client"},{default:l(()=>[s("div",Fe,[ge,s("span",be,u(e.info.Clients.connected_clients),1)]),s("div",Ee,[ye,s("span",Ce,u(e.info.Clients.blocked_clients),1)])]),_:1}),t(p,{title:"Keyspace(key\u4FE1\u606F)",name:"keyspace"},{default:l(()=>[(f(!0),g(B,null,D(e.info.Keyspace,(a,m)=>(f(),g("div",{class:"row",key:m},[s("span",Be,u(m)+": ",1),s("span",De,u(a),1)]))),128))]),_:1}),t(p,{title:"Stats(\u7EDF\u8BA1)",name:"state"},{default:l(()=>[s("div",we,[Ae,s("span",je,u(e.info.Stats.total_commands_processed),1)]),s("div",$e,[Ve,s("span",ke,u(e.info.Stats.instantaneous_ops_per_sec),1)]),s("div",Ie,[qe,s("span",Ue,u(e.info.Stats.total_net_input_bytes),1)]),s("div",Se,[Pe,s("span",Re,u(e.info.Stats.total_net_output_bytes),1)]),s("div",Me,[Te,s("span",Le,u(e.info.Stats.expired_keys),1)]),s("div",Ne,[ze,s("span",Oe,u(e.info.Stats.instantaneous_ops_per_sec),1)])]),_:1}),t(p,{title:"Persistence(\u6301\u4E45\u5316)",name:"persistence"},{default:l(()=>[s("div",Ke,[Ge,s("span",Je,u(e.info.Persistence.aof_enabled),1)]),s("div",He,[Qe,s("span",We,u(e.info.Persistence.loading),1)])]),_:1}),t(p,{title:"Cluster(\u96C6\u7FA4)",name:"cluster"},{default:l(()=>[s("div",Xe,[Ye,s("span",Ze,u(e.info.Cluster.cluster_enabled),1)])]),_:1}),t(p,{title:"Memory(\u5185\u5B58\u6D88\u8017\u76F8\u5173\u4FE1\u606F)",name:"memory"},{default:l(()=>[s("div",xe,[es,s("span",ss,u(e.info.Memory.used_memory_human),1)]),s("div",os,[ts,s("span",ls,u(e.info.Memory.maxmemory),1)]),s("div",us,[ns,s("span",as,u(e.info.Memory.used_memory_rss_human),1)]),s("div",is,[rs,s("span",ds,u(e.info.Memory.mem_fragmentation_ratio),1)]),s("div",cs,[ps,s("span",_s,u(e.info.Memory.used_memory_peak_human),1)]),s("div",ms,[fs,s("span",vs,u(e.info.Memory.total_system_memory_human),1)])]),_:1}),t(p,{title:"CPU",name:"cpu"},{default:l(()=>[s("div",hs,[Fs,s("span",gs,u(e.info.CPU.used_cpu_sys),1)]),s("div",bs,[Es,s("span",ys,u(e.info.CPU.used_cpu_user),1)]),s("div",Cs,[Bs,s("span",Ds,u(e.info.CPU.used_cpu_sys_children),1)]),s("div",ws,[As,s("span",js,u(e.info.CPU.used_cpu_user_children),1)])]),_:1})]),_:1})]),_:1},8,["title","modelValue"])])}var Vs=j(X,[["render",$s]]);const ks=$({name:"RedisEdit",props:{visible:{type:Boolean},projects:{type:Array},redis:{type:[Boolean,Object]},title:{type:String}},setup(e,{emit:o}){const d=H(null),i=V({dialogVisible:!1,projects:[],envs:[],form:{id:null,name:null,host:null,password:null,project:null,projectId:null,envId:null,env:null},btnLoading:!1,rules:{projectId:[{required:!0,message:"\u8BF7\u9009\u62E9\u9879\u76EE",trigger:["change","blur"]}],envId:[{required:!0,message:"\u8BF7\u9009\u62E9\u73AF\u5883",trigger:["change","blur"]}],host:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E3B\u673Aip:port",trigger:["change","blur"]}],db:[{required:!0,message:"\u8BF7\u8F93\u5165\u5E93\u53F7",trigger:["change","blur"]}]}});R(e,async a=>{i.dialogVisible=a.visible,i.projects=a.projects,a.redis?(F(a.redis.projectId),i.form=E({},a.redis)):(i.envs=[],i.form={db:0})});const F=async a=>{i.envs=await M.projectEnvs.request({projectId:a})},v=a=>{for(let m of i.projects)m.id==a&&(i.form.project=m.name);i.envs=[],F(a)},p=a=>{for(let m of i.envs)m.id==a&&(i.form.env=m.name)},h=async()=>{d.value.validate(a=>{if(a)w.saveRedis.request(i.form).then(()=>{I.success("\u4FDD\u5B58\u6210\u529F"),o("val-change",i.form),i.btnLoading=!0,setTimeout(()=>{i.btnLoading=!1},1e3),n()});else return I.error("\u8BF7\u6B63\u786E\u586B\u5199\u4FE1\u606F"),!1})},n=()=>{o("update:visible",!1),o("cancel"),setTimeout(()=>{d.value.resetFields(),i.form={}},200)};return C(E({},k(i)),{redisForm:d,changeProject:v,changeEnv:p,btnOk:h,cancel:n})}}),Is={class:"dialog-footer"},qs=b("\u786E \u5B9A"),Us=b("\u53D6 \u6D88");function Ss(e,o,d,i,F,v){const p=_("el-option"),h=_("el-select"),n=_("el-form-item"),a=_("el-input"),m=_("el-form"),y=_("el-button"),A=_("el-dialog");return f(),g("div",null,[t(A,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":o[6]||(o[6]=r=>e.dialogVisible=r),"show-close":!1,"before-close":e.cancel,width:"35%"},{footer:l(()=>[s("div",Is,[t(y,{type:"primary",loading:e.btnLoading,onClick:e.btnOk},{default:l(()=>[qs]),_:1},8,["loading","onClick"]),t(y,{onClick:o[5]||(o[5]=r=>e.cancel())},{default:l(()=>[Us]),_:1})])]),default:l(()=>[t(m,{model:e.form,ref:"redisForm",rules:e.rules,"label-width":"85px"},{default:l(()=>[t(n,{prop:"projectId",label:"\u9879\u76EE:",required:""},{default:l(()=>[t(h,{style:{width:"100%"},modelValue:e.form.projectId,"onUpdate:modelValue":o[0]||(o[0]=r=>e.form.projectId=r),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",onChange:e.changeProject,filterable:""},{default:l(()=>[(f(!0),g(B,null,D(e.projects,r=>(f(),q(p,{key:r.id,label:`${r.name} [${r.remark}]`,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),t(n,{prop:"envId",label:"\u73AF\u5883:",required:""},{default:l(()=>[t(h,{onChange:e.changeEnv,style:{width:"100%"},modelValue:e.form.envId,"onUpdate:modelValue":o[1]||(o[1]=r=>e.form.envId=r),placeholder:"\u8BF7\u9009\u62E9\u73AF\u5883"},{default:l(()=>[(f(!0),g(B,null,D(e.envs,r=>(f(),q(p,{key:r.id,label:`${r.name} [${r.remark}]`,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["onChange","modelValue"])]),_:1}),t(n,{prop:"host",label:"host:",required:""},{default:l(()=>[t(a,{modelValue:e.form.host,"onUpdate:modelValue":o[2]||(o[2]=r=>e.form.host=r),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165host:port","auto-complete":"off"},null,8,["modelValue"])]),_:1}),t(n,{prop:"password",label:"\u5BC6\u7801:"},{default:l(()=>[t(a,{type:"password","show-password":"",modelValue:e.form.password,"onUpdate:modelValue":o[3]||(o[3]=r=>e.form.password=r),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),t(n,{prop:"db",label:"\u5E93\u53F7:",required:""},{default:l(()=>[t(a,{modelValue:e.form.db,"onUpdate:modelValue":o[4]||(o[4]=r=>e.form.db=r),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u5E93\u53F7"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}var Ps=j(ks,[["render",Ss]]);const Rs=$({name:"RedisList",components:{Info:Vs,RedisEdit:Ps},setup(){const e=V({projects:[],redisTable:[],total:0,currentId:null,currentData:null,query:{pageNum:1,pageSize:10,prjectId:null,clusterId:null},redisInfo:{url:""},clusters:[{id:0,name:"\u5355\u673A"}],infoDialog:{title:"",visible:!1,info:{Server:{},Keyspace:{},Clients:{},CPU:{},Memory:{}}},redisEditDialog:{visible:!1,data:null,title:"\u65B0\u589Eredis"}});Q(async()=>{v(),e.projects=(await M.projects.request({pageNum:1,pageSize:100})).list});const o=n=>{e.query.pageNum=n,v()},d=n=>{!n||(e.currentId=n.id,e.currentData=n)},i=async()=>{try{await W.confirm("\u786E\u5B9A\u5220\u9664\u8BE5redis?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await w.delRedis.request({id:e.currentId}),I.success("\u5220\u9664\u6210\u529F"),e.currentData=null,e.currentId=null,v()}catch{}},F=n=>{w.redisInfo.request({id:n.id}).then(a=>{e.infoDialog.info=a,e.infoDialog.title=`'${n.host}' info`,e.infoDialog.visible=!0})},v=async()=>{const n=await w.redisList.request(e.query);e.redisTable=n.list,e.total=n.total},p=(n=!1)=>{n?(e.redisEditDialog.data=null,e.redisEditDialog.title="\u65B0\u589Eredis"):(e.redisEditDialog.data=e.currentData,e.redisEditDialog.title="\u4FEE\u6539redis"),e.redisEditDialog.visible=!0},h=()=>{v()};return C(E({},k(e)),{search:v,handlePageChange:o,choose:d,info:F,deleteRedis:i,editRedis:p,valChange:h})}}),Ms=b("\u6DFB\u52A0"),Ts=b("\u7F16\u8F91"),Ls=b("\u5220\u9664"),Ns={style:{float:"right"}},zs=s("i",null,null,-1),Os=b("info");function Ks(e,o,d,i,F,v){const p=_("el-button"),h=_("el-option"),n=_("el-select"),a=_("el-radio"),m=_("el-table-column"),y=_("el-table"),A=_("el-pagination"),r=_("el-row"),T=_("el-card"),L=_("info"),N=_("redis-edit");return f(),g("div",null,[t(T,null,{default:l(()=>[t(p,{type:"primary",icon:"plus",onClick:o[0]||(o[0]=c=>e.editRedis(!0)),plain:""},{default:l(()=>[Ms]),_:1}),t(p,{type:"primary",icon:"edit",disabled:e.currentId==null,onClick:o[1]||(o[1]=c=>e.editRedis(!1)),plain:""},{default:l(()=>[Ts]),_:1},8,["disabled"]),t(p,{type:"danger",icon:"delete",disabled:e.currentId==null,onClick:e.deleteRedis,plain:""},{default:l(()=>[Ls]),_:1},8,["disabled","onClick"]),s("div",Ns,[t(n,{modelValue:e.query.projectId,"onUpdate:modelValue":o[2]||(o[2]=c=>e.query.projectId=c),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",filterable:"",clearable:""},{default:l(()=>[(f(!0),g(B,null,D(e.projects,c=>(f(),q(h,{key:c.id,label:`${c.name} [${c.remark}]`,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(p,{class:"ml5",onClick:e.search,type:"success",icon:"search"},null,8,["onClick"])]),t(y,{data:e.redisTable,style:{width:"100%"},onCurrentChange:e.choose},{default:l(()=>[t(m,{label:"\u9009\u62E9",width:"60px"},{default:l(c=>[t(a,{modelValue:e.currentId,"onUpdate:modelValue":o[3]||(o[3]=U=>e.currentId=U),label:c.row.id},{default:l(()=>[zs]),_:2},1032,["modelValue","label"])]),_:1}),t(m,{prop:"project",label:"\u9879\u76EE",width:""}),t(m,{prop:"env",label:"\u73AF\u5883",width:""}),t(m,{prop:"host",label:"host:port",width:""}),t(m,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:l(c=>[b(u(e.$filters.dateFormat(c.row.createTime)),1)]),_:1}),t(m,{prop:"creator",label:"\u521B\u5EFA\u4EBA"}),t(m,{label:"\u64CD\u4F5C",width:""},{default:l(c=>[t(p,{type:"primary",onClick:U=>e.info(c.row),icon:"tickets",plain:"",size:"small"},{default:l(()=>[Os]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onCurrentChange"]),t(r,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:l(()=>[t(A,{style:{"text-align":"right"},onCurrentChange:e.handlePageChange,total:e.total,layout:"prev, pager, next, total, jumper","current-page":e.query.pageNum,"onUpdate:current-page":o[4]||(o[4]=c=>e.query.pageNum=c),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1})]),_:1}),t(L,{visible:e.infoDialog.visible,"onUpdate:visible":o[5]||(o[5]=c=>e.infoDialog.visible=c),title:e.infoDialog.title,info:e.infoDialog.info},null,8,["visible","title","info"]),t(N,{onValChange:e.valChange,projects:e.projects,title:e.redisEditDialog.title,visible:e.redisEditDialog.visible,"onUpdate:visible":o[6]||(o[6]=c=>e.redisEditDialog.visible=c),redis:e.redisEditDialog.data,"onUpdate:redis":o[7]||(o[7]=c=>e.redisEditDialog.data=c)},null,8,["onValChange","projects","title","visible","redis"])])}var Ys=j(Rs,[["render",Ks]]);export{Ys as default};
